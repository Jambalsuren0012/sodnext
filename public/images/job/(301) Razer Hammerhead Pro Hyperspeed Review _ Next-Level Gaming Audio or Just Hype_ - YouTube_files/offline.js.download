(function(g){var window=this;'use strict';var SBj=function(V){var t=new g.u8("und",new g.fe("Default","und",!0));t.captionTracks=V.captionTracks;return t},Glr=function(V){return new g.Ij(function(t,x){var u=V.length,Z=[];
if(u)for(var P=function(b,E){u--;Z[b]=E;u==0&&t(Z)},K=function(b){x(b)},R,f=0;f<V.length;f++)R=V[f],g.wxw(R,g.ds(P,f),K);
else t(Z)})},TN=function(V){this.J=V},W9=function(){TN.apply(this,arguments)},I7j=function(){W9.apply(this,arguments)},vSr=function(){W9.apply(this,arguments)},L0_=function(){W9.apply(this,arguments)},F0s=function(){W9.apply(this,arguments)},MNt=function(){W9.apply(this,arguments)},gS$=function(){W9.apply(this,arguments)},X$j=function(){TN.apply(this,arguments)},zUF=function(){W9.apply(this,arguments)},Bz_=function(){W9.apply(this,arguments)},m5n=function(){W9.apply(this,arguments)},YBt=function(){W9.apply(this,
arguments)},QNc=function(){W9.apply(this,arguments)},a7r=function(){W9.apply(this,arguments)},rn$=function(){W9.apply(this,arguments)},Tz7=function(){W9.apply(this,arguments)},W0E=function(){W9.apply(this,arguments)},oSF=function(){W9.apply(this,arguments)},nS7=function(){W9.apply(this,arguments)},cnj=function(){W9.apply(this,arguments)},yn7=function(){TN.apply(this,arguments)},jNn=function(){W9.apply(this,arguments)},l77=function(){W9.apply(this,arguments)},H27=function(){W9.apply(this,arguments)},
U5U=function(){W9.apply(this,arguments)},D5i=function(){W9.apply(this,arguments)},eUi=function(){W9.apply(this,arguments)},d5$=function(){W9.apply(this,arguments)},CqF=function(){W9.apply(this,arguments)},JnE=function(){W9.apply(this,arguments)},hUt=function(){TN.apply(this,arguments)},w$Y=function(){TN.apply(this,arguments)},V9_=function(){TN.apply(this,arguments)},t9F=function(){W9.apply(this,arguments)},xA_=function(){W9.apply(this,arguments)},utj=function(){W9.apply(this,arguments)},Z_c=function(){W9.apply(this,
arguments)},PWE=function(){W9.apply(this,arguments)},KWi=function(){W9.apply(this,arguments)},qwr=function(){W9.apply(this,arguments)},Rii=function(){W9.apply(this,arguments)},fdY=function(){W9.apply(this,arguments)},$Ar=function(){W9.apply(this,arguments)},b_c=function(){W9.apply(this,arguments)},EwY=function(){W9.apply(this,arguments)},kCz=function(){W9.apply(this,arguments)},i_Y=function(){W9.apply(this,arguments)},O_7=function(){W9.apply(this,arguments)},sx7=function(){W9.apply(this,arguments)},
NKz=function(){W9.apply(this,arguments)},pYU=function(){W9.apply(this,arguments)},AOs=function(){W9.apply(this,arguments)},SwF=function(){W9.apply(this,arguments)},GCj=function(){W9.apply(this,arguments)},Idj=function(){W9.apply(this,arguments)},vws=function(){W9.apply(this,arguments)},LWj=function(){W9.apply(this,arguments)},FWU=function(){W9.apply(this,arguments)},M9Y=function(){TN.apply(this,arguments)},gwi=function(){W9.apply(this,arguments)},XYF=function(){W9.apply(this,arguments)},zic=function(){W9.apply(this,
arguments)},BKc=function(){W9.apply(this,arguments)},mAE=function(){W9.apply(this,arguments)},Ywt=function(){W9.apply(this,arguments)},Qxs=function(){W9.apply(this,arguments)},adE=function(){W9.apply(this,arguments)},rOF=function(){W9.apply(this,arguments)},TK$=function(){W9.apply(this,arguments)},WW7=function(){W9.apply(this,arguments)},own=function(){W9.apply(this,arguments)},nw7=function(){W9.apply(this,arguments)},cO$=function(){W9.apply(this,arguments)},yOU=function(){W9.apply(this,arguments)},
jxE=function(){W9.apply(this,arguments)},ldY=function(){W9.apply(this,arguments)},H_i=function(){W9.apply(this,arguments)},UAF=function(){W9.apply(this,arguments)},DAE=function(){W9.apply(this,arguments)},eir=function(){W9.apply(this,arguments)},dAF=function(){W9.apply(this,arguments)},CW_=function(){W9.apply(this,arguments)},JO$=function(){W9.apply(this,arguments)},hi7=function(){W9.apply(this,arguments)},wYU=function(){W9.apply(this,arguments)},Vhi=function(){W9.apply(this,arguments)},ths=function(){W9.apply(this,
arguments)},xq_=function(){W9.apply(this,arguments)},uNY=function(V){V=V.key||V.id;
if(!V)throw Error("Entity key is missing");return V},ZkY=function(){if(oH)return oH();
var V={};oH=g.fg("PersistentEntityStoreDb",{WY:(V.EntityStore={f7:1},V.EntityAssociationStore={f7:2},V),shared:!1,upgrade:function(t,x){x(1)&&g.Hr(g.o4(t,"EntityStore",{keyPath:"key"}),"entityType","entityType");x(2)&&(t=g.o4(t,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Hr(t,"byParentEntityKey","parentEntityKey"),g.Hr(t,"byChildEntityKey","childEntityKey"))},
version:3});return oH()},P5z=function(V){return g.wu(ZkY(),V)},K97=function(V){return g.wu((0,g.VVF)(),V)},nT=function(V){this.token=V},c9=function(V,t){t=t===void 0?{}:t;
g.xe.call(this,g.tVs[V],Object.assign({},{name:"PESEncoderError",type:V},t));this.type=V;this.level="WARNING";Object.setPrototypeOf(this,c9.prototype)},qI$=function(V){return new c9("WRONG_DATA_TYPE",{v5:V})},RR7=function(V){return V instanceof Error?new c9("UNKNOWN_ENCODE_ERROR",{lj:V.message}):new c9("UNKNOWN_ENCODE_ERROR")},fyi=function(V){return V instanceof Error?new c9("UNKNOWN_DECODE_ERROR",{lj:V.message}):new c9("UNKNOWN_DECODE_ERROR")},$qi=function(V,t){V=V instanceof c9?V:t(V);
g.jv(V);throw V;},bk_=function(){},Ef$=function(V,t,x){try{return V.N(t,x)}catch(u){$qi(u,RR7)}},kIr=function(V){V=(new TextEncoder).encode(V).subarray(0,16);
var t=new Uint8Array(16);t.set(V);return t},yQ=function(V){this.J=V},Oki=function(V){var t=ikU[V];
if(t)return t;g.lf(new g.xe("Entity model not found.",{entityType:V}))},sQs=function(V,t){this.J=V;
this.S=t;this.N={}},pRr=function(V,t){a:{V=NkE(V.S,t.version);
try{var x=V.S(t.data,t.key);break a}catch(u){$qi(u,fyi)}x=void 0}return x},jd=function(V,t,x){return V.J.objectStore("EntityStore").get(t).then(function(u){if(u){if(x&&u.entityType!==x)throw Error("Incorrect entity type");
return pRr(V,u)}})},lO=function(V,t,x){return x?(x=x.map(function(u){return jd(V,u,t)}),g.Ye.all(x)):V.J.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(t)).then(function(u){return u.map(function(Z){return pRr(V,Z)})})},U_=function(V,t,x){var u=uNY(t),Z=NkE(V.S,1),P=Object.assign({},t);
return V.J.objectStore("EntityStore").get(u).then(function(K){if(K){if(K.entityType!==x)throw Error("Incorrect entity type");P.entityMetadata||(K=pRr(V,K),P.entityMetadata=K.entityMetadata)}}).then(function(){var K={key:u,
entityType:x,data:Ef$(Z,P,u),version:1};return g.Ye.all([g.yU(V.J.objectStore("EntityStore"),K),AXz(V,P,x)])}).then(function(){H9(V,u,x);
return u})},SIU=function(V,t,x){t=t.map(function(u){return U_(V,u,x)});
return g.Ye.all(t)},DR=function(V,t,x){if(x==null?0:x.Nw){var u=new Set;
return GIc(V,t,u).then(function(){for(var P=[],K=g.G(u),R=K.next();!R.done;R=K.next())P.push(DR(V,R.value));return g.Ye.all(P).then(function(){})})}var Z=g.Oi(t).entityType;
return g.Ye.all([V.J.objectStore("EntityStore").delete(t),Iy$(V,t)]).then(function(){H9(V,t,Z)})},vfr=function(V,t){return g.du(V.J.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(t)},function(x){return g.Ye.all([x.delete(),
Iy$(V,x.cursor.primaryKey)]).then(function(){H9(V,x.cursor.primaryKey,t);return g.Dw(x)})})},L9z=function(V,t,x,u){var Z=NkE(V.S,1);
return jd(V,t,u).then(function(P){if(P){P=g.Fn(P,x);var K={key:t,entityType:u,data:Ef$(Z,P,t),version:1};return g.Ye.all([g.yU(V.J.objectStore("EntityStore"),K),AXz(V,P,u)])}}).then(function(){H9(V,t,u);
return t})},H9=function(V,t,x){var u=V.N[x];
u||(u=new Set,V.N[x]=u);u.add(t)},F9i=function(V,t,x){var u=uNY(t);
x=Oki(x);if(!x)return g.Ye.resolve([]);x=new x(t);V=V.J.objectStore("EntityAssociationStore");t=[];x=g.G(x.S());for(var Z=x.next();!Z.done;Z=x.next())t.push(g.yU(V,{parentEntityKey:u,childEntityKey:Z.value}));return g.Ye.all(t).then(function(P){return P.map(function(K){return K[1]})})},Iy$=function(V,t){return V.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(t))},AXz=function(V,t,x){var u=uNY(t);
return Iy$(V,u).then(function(){return F9i(V,t,x)})},GIc=function(V,t,x){if(x.has(t))return g.Ye.resolve(void 0);
x.add(t);return Mhc(V,t).then(function(u){return V.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(t)).then(function(){return u})}).then(function(u){var Z=g.Ye.resolve(void 0);
u=g.G(u);for(var P=u.next(),K={};!P.done;K={rp:void 0},P=u.next())K.rp=P.value,Z=Z.then(function(R){return function(){return GIc(V,R.rp,x)}}(K));
return Z}).then(function(){})},Mhc=function(V,t){var x=V.J.objectStore("EntityAssociationStore");
return x.index("byParentEntityKey").getAll(IDBKeyRange.only(t)).then(function(u){var Z=[];u=g.G(u);for(var P=u.next();!P.done;P=u.next())P=P.value,Z.push(x.index("byChildEntityKey").getAll(P.childEntityKey));return g.Ye.all(Z)}).then(function(u){var Z=[];
u=g.G(u);for(var P=u.next();!P.done;P=u.next())P=P.value,P.length===1&&Z.push(P[0].childEntityKey);return Z})},ed=function(){},gfU=function(){this.J={};
this.J[0]=new ed;if(!g.Bc("aes_pes_encoder_killswitch")){var V=this.J;try{var t=g.uU();var x=kIr(t);var u=new yQ(new g.ms(x),new g.Bl(x))}catch(Z){throw V=Z instanceof Error?new c9("KEY_CREATION_FAILED",{lj:Z.message}):new c9("KEY_CREATION_FAILED"),g.jv(V),V;}V[1]=u}},NkE=function(V,t){t=t===void 0?0:t;
V=V.J[t];if(!V)throw t=new c9("INVALID_ENCODER_VERSION",{v5:t}),g.jv(t),t;return V},d6=function(V,t){g.c.call(this);
this.token=V;this.J=t;this.observers=[];V=new g.Ww.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.uU());V.onmessage=this.S.bind(this);this.channel=V},CT=function(V,t,x){var u,Z,P,K;
return g.Q(function(R){if(R.J==1)return g.m(R,P5z(V.token),2);if(R.J!=3)return u=R.S,g.m(R,g.cr(u,["EntityStore","EntityAssociationStore"],t,function(f){Z=new sQs(f,V.J);return x(Z)}),3);
P=R.S;Z&&(K=Z.N,Object.keys(K).length>0&&(V.channel.postMessage(K),XRE(V,K)));return R.return(P)})},Jg=function(V,t,x){return CT(V,{mode:"readwrite",
LI:!0},function(u){return U_(u,t,x)})},zRj=function(V,t){return CT(V,{mode:"readwrite",
LI:!0},function(x){return SIU(x,t,"offlineOrchestrationActionWrapperEntity")})},Bk$=function(V,t){return CT(V,{mode:"readwrite",
LI:!0},function(x){return DR(x,t)})},mqj=function(V){return CT(V,{mode:"readwrite",
LI:!0},function(t){return vfr(t,"videoPlaybackPositionEntity")})},hg=function(V,t,x){return CT(V,{mode:"readonly",
LI:!0},function(u){return jd(u,t,x)})},w6=function(V,t,x){return CT(V,{mode:"readonly",
LI:!0},function(u){return lO(u,t,x)})},XRE=function(V,t){V=g.G(V.observers);
for(var x=V.next();!x.done;x=V.next())x=x.value,x(t)},YIE=function(){var V,t,x;
return g.Q(function(u){if(u.J==1)return g.AT(u,2),g.m(u,g.qR(),4);if(u.J!=2){V=u.S;if(!V||!g.Zw()||typeof g.Ww.BroadcastChannel==="undefined")return u.return();t=new gfU;return u.return(new d6(V,t))}x=g.I9(u);x instanceof Error&&g.jv(x);return u.return()})},VH=function(){QQ_||(QQ_=YIE());
return QQ_},ayU=function(V){var t;
V=(t=V.options)==null?void 0:t.persistenceOption;return V==="ENTITY_PERSISTENCE_OPTION_PERSIST"||V==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},rXc=function(V){var t;
return g.Q(function(x){return x.J==1?g.m(x,VH(),2):(t=x.S)?g.m(x,CT(t,"readwrite",function(u){for(var Z={},P=g.G(V),K=P.next(),R={};!K.done;R={K6:void 0,c_:void 0},K=P.next())R.K6=K.value,R.K6.entityKey&&ayU(R.K6)&&(R.c_=g.M8(R.K6.payload),K=void 0,R.K6.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(K=function(f){return function(){return U_(u,f.K6.payload[f.c_],f.c_)}}(R)),R.K6.type==="ENTITY_MUTATION_TYPE_DELETE"&&(K=function(f){return function(){return DR(u,f.K6.entityKey)}}(R)),R.K6.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(K=function(f){return function(){return L9z(u,f.K6.entityKey,f.K6.payload[f.c_],f.c_)}}(R)),K&&(Z[R.K6.entityKey]=Z[R.K6.entityKey]?Z[R.K6.entityKey].then(K):K()));
return g.Ye.all(Object.values(Z))}),0):x.return()})},Tk$=function(V){var t;
return g.Q(function(x){if(x.J==1){t=V.mutations;if(!t||t.length<=0)return x.return();if(g.x8){var u={type:"ENTITY_LOADED"};t!==void 0&&(u.payload=t);g.x8.dispatch(u)}return g.m(x,rXc(t),2)}t.length=0;g.pl(x)})},W9U=function(V){return V!==void 0},ofE=function(V){var t=g.zQ();
t=Object.assign({},t);V=Object.assign({},V);for(var x in t)V[x]?(t[x]!==4&&(t[x]=V[x]),delete V[x]):t[x]!==2&&(t[x]=4);Object.assign(t,V);g.HZq(t);JSON.stringify(t);return t},nfz=function(V){var t,x;
return g.Q(function(u){if(u.J==1)return g.m(u,g.qR(),2);if(u.J!=3)return(t=u.S)?g.m(u,g.YX(t),3):u.return();x=u.S;return u.return(g.cr(x,["index","media","captions"],{mode:"readwrite",LI:!0},function(Z){var P=IDBKeyRange.bound(V+"|",V+"~");Z=[Z.objectStore("index").delete(P),Z.objectStore("media").delete(P),Z.objectStore("captions").delete(P)];return g.Ye.all(Z).then(function(){})}))})},cXc=function(){var V,t;
return g.Q(function(x){if(x.J==1)return g.m(x,g.qR(),2);if(x.J!=3){V=x.S;if(!V)throw g.Br("rvdfd");return g.m(x,g.YX(V),3)}t=x.S;return x.return(g.cr(t,["index","media"],{mode:"readwrite",LI:!0},function(u){var Z={};return g.Un(u.objectStore("index"),{},function(P){var K=P.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),R=g.Ye.resolve(void 0);if(K){var f=K[1];K=K[2];Z[f]=Z[f]||{};var b;Z[f][K]=g.C_z((b=P.getValue())==null?void 0:b.fmts)}else R=P.delete().then(function(){});
return g.Ye.all([g.Dw(P),R]).then(function(E){return g.G(E).next().value})}).then(function(){for(var P={},K=g.G(Object.keys(Z)),R=K.next();!R.done;R=K.next()){R=R.value;
var f=Z[R].v;P[R]=Z[R].a&&f?1:2}var b=ofE(P);return g.zJK(u.objectStore("media"),{},function(E){var k=E.cursor.key.match(g.Vlj);k&&P[k[1]]||u.objectStore("media").delete(E.cursor.key);return g.SU9(E)}).then(function(){return b})})}))})},yXs=function(V,t){var x,u;
return g.Q(function(Z){if(Z.J==1)return g.m(Z,g.qR(),2);if(Z.J!=3){x=Z.S;if(!x)throw g.Br("wct");return g.m(Z,g.YX(x),3)}u=Z.S;return g.m(Z,g.cr(u,["captions"],{mode:"readwrite",LI:!0},function(P){var K=[];P=P.objectStore("captions");for(var R=0;R<t.length;R++){var f=g.yU(P,t[R],V+"|"+t[R].metadata.vss_id);K.push(f)}return g.Ye.all(K)}),0)})},jQY=function(V){var t,x,u;
return g.Q(function(Z){if(Z.J==1)return t=IDBKeyRange.bound(V+"|",V+"~"),g.m(Z,g.qR(),2);if(Z.J!=3){x=Z.S;if(!x)throw g.Br("gactfv");return g.m(Z,g.YX(x),3)}u=Z.S;return Z.return(u.getAll("captions",t))})},lyj=function(V){return g.Q(function(t){g.mr(V,0);
return t.return(nfz(V))})},Hkc=function(V){return{context:g.K4(),
videoIds:V}},Uq_=function(V){return{context:g.K4(),
playlistIds:V}},Dqc=function(V){return{context:g.K4(),
offlinePlaylistSyncChecks:V}},eRU=function(){this.J=new Map},C57=function(){dqr||(dqr=new eRU);
return dqr},JXE=function(V,t){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:V},metadata:t,statusCode:void 0,csn:void 0,can:void 0}},hRn=function(V,t,x){if(!x){var u=u===void 0?!1:u;
x=V.J.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!x||u)x=g.m3(16),V.J.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",x)}V={flowNonce:x,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:t.eventType};t.metadata&&(V.flowMetadata=t.metadata);t.statusCode!==void 0&&(V.flowEventStatus=t.statusCode);t.csn&&(V.csn=t.csn);t.can&&(V.can=t.can);g.pq("flowEvent",V,void 0)},wRs=function(V){var t,x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt,F,X,B;
return g.Q(function(a){if(a.J==1)return g.m(a,CT(V,{mode:"readonly",LI:!0},function(W){return lO(W,"playbackData").then(function(tT){var Pw=tT.map(function(s4){return s4.transfer}).filter(function(s4){return!!s4}),Kl=tT.map(function(s4){return s4.offlineVideoPolicy}).filter(function(s4){return!!s4}),T=tT.filter(function(s4){return!!s4.key}).map(function(s4){return g.si(g.Oi(s4.key).entityId,"downloadStatusEntity")});
Pw=lO(W,"transfer",Pw);Kl=lO(W,"offlineVideoPolicy",Kl);T=lO(W,"downloadStatusEntity",T);var bL=Pw.then(function(s4){s4=s4.reduce(function(fl,mh){(mh==null?0:mh.offlineVideoStreams)&&fl.push.apply(fl,g.v(mh.offlineVideoStreams));return fl},[]).filter(function(fl){return!!fl});
return lO(W,"offlineVideoStreams",s4)});
return g.Ye.all([Pw,Kl,bL,T]).then(function(s4){var fl=g.G(s4);s4=fl.next().value;var mh=fl.next().value;var E$=fl.next().value;fl=fl.next().value;return[tT,s4,mh,E$,fl]})})}),2);
if(a.J!=3)return t=a.S,g.m(a,CT(V,{mode:"readonly",LI:!0},function(W){return lO(W,"mainDownloadsListEntity").then(function(tT){var Pw,Kl;return(Kl=(Pw=tT[0])==null?void 0:Pw.downloads)!=null?Kl:[]})}),3);
x=a.S;u=g.G(t);Z=u.next().value;P=u.next().value;K=u.next().value;R=u.next().value;f=u.next().value;b=Z;E=P;k=K;O=R;N=f;p={};I={};L={};M={};z={};Y=[];r=g.G(E);for(n=r.next();!n.done;n=r.next())(U=n.value)&&(p[U.key]=U);d=g.G(k);for(uL=d.next();!uL.done;uL=d.next())(q1=uL.value)&&(I[q1.key]=q1);w=g.G(N);for(H=w.next();!H.done;H=w.next())(C=H.value)&&(L[C.key]=C);S=g.G(O);for(D=S.next();!D.done;D=S.next())(ws=D.value)&&(M[ws.key]=ws);Ic=g.G(x);for(t_=Ic.next();!t_.done;t_=Ic.next())gs=t_.value,Cl=void 0,
z[(Cl=gs.videoItem)!=null?Cl:""]=!0,gs.videoItem&&(Nt=uz=void 0,F=(Nt=(uz=g.Oi(gs.videoItem))==null?void 0:uz.entityId)!=null?Nt:"",Y.push({externalVideoId:F}));X=b.filter(function(W){if(!W||!W.key||!W.offlineVideoPolicy)return!1;W=g.Oi(W.key).entityId;W=g.si(W,"downloadStatusEntity");var tT;return!(W&&((tT=L[W])==null?void 0:tT.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
B=X.map(function(W){var tT=p[W.transfer],Pw=[];if(tT==null?0:tT.offlineVideoStreams)for(var Kl=g.G(tT.offlineVideoStreams),T=Kl.next();!T.done;T=Kl.next())(T=M[T.value])&&Pw.push(T);Kl=I[W.offlineVideoPolicy];T=z;var bL=W==null?void 0:W.playerResponseTimestamp,s4=g.Oi(Kl.key).entityId;W=g.si(s4,"mainVideoEntity");if(Kl.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var fl="OFFLINE_VIDEO_STATE_DISABLED";Kl.expirationTimestamp&&Number(Kl.expirationTimestamp)<Date.now()/1E3&&(fl="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Kl.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")fl="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(tT==null?void 0:tT.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":fl="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":fl="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":fl="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":fl="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":fl="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":fl="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:fl="OFFLINE_VIDEO_STATE_UNKNOWN"}if(fl==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(tT==null?void 0:tT.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":fl="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":fl="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":fl=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}s4={id:s4,videoState:fl};if(tT==null?0:tT.cotn)s4.cotn=tT.cotn;if(tT==null?0:tT.maximumDownloadQuality)s4.selectedVideoQuality=tT==null?void 0:tT.maximumDownloadQuality;if(tT==null?0:tT.lastProgressTimeMs)s4.lastProgressTimeMs=tT.lastProgressTimeMs;bL&&(s4.playerResponseSavedTimeMs=String(Number(bL)*1E3));tT=String;bL=0;Pw=g.G(Pw);for(fl=Pw.next();!fl.done;fl=Pw.next())if(fl=fl.value,fl.streamsProgress){fl=g.G(fl.streamsProgress);for(var mh=fl.next();!mh.done;mh=
fl.next()){var E$=void 0;bL+=Number((E$=mh.value.numBytesDownloaded)!=null?E$:0)}}s4.downloadedBytes=tT(bL);s4.selectedOfflineMode=T[W]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Kl.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(s4.offlinePlaybackDisabledReason=Kl.offlinePlaybackDisabledReason);return s4});
return a.return({offlineVideos:B,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:Y}}})})},V3n=function(){this.locks=navigator.locks},t3c=function(){try{var V=g.nl("ytglobal.locks_");
if(V)return V;var t;if(t=navigator){var x=navigator;t="locks"in x&&!!x.locks}if(t)return g.Ww.localStorage&&g.Ww.localStorage.getItem("noop"),V=new V3n,g.o9("ytglobal.locks_",V),V}catch(u){}},tG=function(){},xsF=function(){},udU=function(V){if(V.includes(":"))throw Error("Invalid user cache name: "+V);
return V+":"+g.uU("CacheStorage get")},ZIU=function(){return g.Q(function(V){if(x3!==void 0)return V.return(x3);
x3=new Promise(function(t){var x;return g.Q(function(u){switch(u.J){case 1:return g.AT(u,2),g.m(u,ul.open("test-only"),4);case 4:return g.m(u,ul.delete("test-only"),5);case 5:g.GK(u,3);break;case 2:if(x=g.I9(u),x instanceof Error&&x.name==="SecurityError")return t(!1),u.return();case 3:t("caches"in window),g.pl(u)}})});
return V.return(x3)})},Kgz=function(){return g.Q(function(V){if(V.J==1)return g.m(V,ZIU(),2);
if(!V.S)return V.return(void 0);Pbi||(Pbi=new xsF);return V.return(Pbi)})},Zm=function(V,t,x){g.lf(new g.xe("Woffle: "+V,x?{cotn:x}:""));
t instanceof Error&&g.lf(t)},qTE=function(V){var t;
return g.Q(function(x){if(x.J==1)return g.m(x,wRs(V),2);t=x.S;g.pq("offlineStateSnapshot",t);g.pl(x)})},PC=function(V){g.c.call(this);
var t=this;this.api=V;this.Wk={wok:function(){return t.J},
LSS:function(){return t.S}};
typeof g.Ww.BroadcastChannel!=="undefined"&&(this.J=new g.Ww.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.uU()),this.J.onmessage=this.N.bind(this),this.S=new g.Ww.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.uU()),this.S.onmessage=this.W.bind(this))},Kc=function(V,t){V.api.Os("onOfflineOperationFailure",t);
var x;(x=V.J)==null||x.postMessage(t)},Rwt=function(V,t,x,u){var Z=this;
this.C=V;this.X=t;this.visibility=x;this.T=u;this.G=this.L=this.B=this.N=this.J=!1;this.W=new g.qK(function(){Z.u7()});
this.Wk={Bt:function(){return Z.S},
u7:function(){Z.u7()},
x4C:function(){return Z.W}};
this.visibility.subscribe("visibilitystatechange",function(){Z.e3()})},f5z=function(V){if(!V.N&&!V.J){var t=t3c();
if(t){V.N=!0;var x=g.uU("OfflineLockManager");t.request("woffle_orchestration_leader:"+x,{},function(){var u,Z,P,K;return g.Q(function(R){switch(R.J){case 1:return g.AT(R,2),V.S=new g.v$,V.J=!0,V.N=!1,g.m(R,V.C(),4);case 4:return g.m(R,V.S.promise,5);case 5:g.GK(R,0);break;case 2:u=g.I9(R),((P=(Z=V).T)==null?0:P.call(Z,"wo_relinquish_leadership_on_lock_request_error"))||V.u7(),u instanceof Error&&(K=u,K.args=[{name:"WoLockManagerError",pS:u.name}],g.jv(K)),g.pl(R)}})})}}},$sc=function(V){V.J&&(V.G=
!0,qG(V))},bIi=function(V,t){V.J&&(V.B=t,qG(V))},EgY=function(V,t){V.J&&(V.L=t,qG(V))},qG=function(V){V.L&&V.B&&V.G&&V.visibility.isBackground()?g.RO(V.W,6E4):V.W.stop()},RU=function(V){var t;
V.offlineDeleteReason=(t=V.offlineDeleteReason)!=null?t:"OFFLINE_DELETE_REASON_UNKNOWN";var x;V.offlineModeType=(x=V.offlineModeType)!=null?x:"OFFLINE_NOW";g.pq("offlineDeleteEvent",V)},fc=function(V,t){var x=t.videoId;
var u=t.l9;t=t.offlineModeType;V.encryptedVideoId=x;V.cotn=u==null?void 0:u.cotn;V.offlineabilityFormatType=u==null?void 0:u.maximumDownloadQuality;var Z;V.isRefresh=(Z=u==null?void 0:u.isRefresh)!=null?Z:!1;var P;V.softErrorCount=(P=u==null?void 0:u.transferRetryCount)!=null?P:0;V.offlineModeType=t!=null?t:"OFFLINE_NOW";(V.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&V.statusType==="UNKNOWN_STATUS_TYPE"||!V.transferStatusType&&!V.statusType)&&g.lf(Error("Woffle unknown transfer status"));
g.pq("offlineTransferStatusChanged",V)},khE=function(V,t,x,u){u={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!u};t&&x&&(t=Math.floor(t/1024).toFixed(),x=Math.floor(x/1024).toFixed(),u.alreadyDownloadedKbytes=t,u.totalFetchedKbytes=t,u.totalContentKbytes=x);fc(u,V)},iIr=function(V){fc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},V)},OIn=function(V){switch(V){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
$3=function(V){var t,x,u;
return((u=(t=V.actionMetadata)==null?void 0:(x=t.retryScheduleIntervalsInSeconds)==null?void 0:x.length)!=null?u:0)>0},bl=function(V){return V.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!V.entityKey},EK=function(V){return V.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!V.entityKey},k3=function(V){return V.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!V.entityKey},soY=function(V){return V.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!V.entityKey},
il=function(V,t,x,u,Z){Z=Z===void 0?!1:Z;
var P,K,R,f,b,E;return g.Q(function(k){if(k.J==1)return P=g.si(V,t),K=g.si(V,"downloadStatusEntity"),g.m(k,CT(x,{mode:"readonly",LI:!0},function(O){return g.Ye.all([jd(O,P,t),jd(O,K,"downloadStatusEntity")])}),2);
R=k.S;f=R.length?R[0]:void 0;if(!f)return k.FX(0);b=NJ_;if(E=R.length>1?R[1]:void 0){if(E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!Z)return k.return();E.downloadState=u}else E={key:K,downloadState:u};g.dx(f,b,E);return g.m(k,CT(x,{mode:"readwrite",LI:!0},function(O){return g.Ye.all([U_(O,f,t),U_(O,E,"downloadStatusEntity")])}),0)})},OK=function(V,t){return V.actionType===t.actionType&&V.entityKey===t.entityKey},sK=function(V,t){if(V&&V.transferState!=="TRANSFER_STATE_COMPLETE"&&V.transferState!==
"TRANSFER_STATE_FAILED"){var x=g.Oi(V.key).entityId;
fc({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:x,l9:V,offlineModeType:t})}},NG=function(V){if(!V||!V.thumbnails)return[];
var t=[];V=g.G(V.thumbnails);for(var x=V.next();!x.done;x=V.next())x=x.value,x.url&&t.push(x.url);return t},p1t=function(V,t,x){x=x===void 0?[]:x;
var u,Z,P,K,R,f,b,E,k,O,N,p,I;return g.Q(function(L){if(L.J==1)return x.length?g.m(L,w6(V,t),2):L.return([]);u=L.S;Z=new Set;P=g.G(u);for(K=P.next();!K.done;K=P.next())if(R=K.value,f=R.id||R.key)b=g.Oi(f).entityId,Z.add(b);E=[];k=g.G(x);for(O=k.next();!O.done;O=k.next())N=O.value,p=N.offlineVideoData,I=void 0,((I=p)==null?0:I.videoId)&&!Z.has(p.videoId)&&E.push(N);return L.return(E)})},Aor=function(V,t,x){return new g.Hi(V,{cotn:t,
raw_player_response:x,download_media:!0,start:Infinity,disable_watch_next:!0})},ST7=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},pc=function(V,t,x,u,Z,P,K,R,f,b,E){this.entityType=V;
this.actionId=t;this.action=x;this.parentActionId=u;this.rootActionId=Z===void 0?t:Z;this.childActionIds=P;this.prereqActionId=K;this.postreqActionIds=R;this.hasChildActionFailed=b;this.retryScheduleIndex=0;this.J=E||Date.now();this.retryScheduleIndex=f||0},AG=function(V){if(!V.key)throw Error("Entity key is required.");
if(!V.actionProto)throw Error("OfflineOrchestrationAction is required.");var t=g.Oi(V.key),x=g.Oi(V.actionProto.entityKey);return new pc(x.entityType,t.entityId,V.actionProto,V.parentActionId,V.rootActionId,V.childActionIds,V.prereqActionId,V.postreqActionIds,V.retryScheduleIndex,V.hasChildActionFailed,Number(V.enqueueTimeSec)*1E3)},S4=function(V){return{key:g.si(V.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:V.action,parentActionId:V.parentActionId,rootActionId:V.rootActionId,childActionIds:V.childActionIds,prereqActionId:V.prereqActionId,postreqActionIds:V.postreqActionIds,retryScheduleIndex:V.retryScheduleIndex,hasChildActionFailed:V.hasChildActionFailed,enqueueTimeSec:(V.J/1E3).toFixed()}},Ght=function(){var V;
return g.Q(function(t){return t.J==1?g.m(t,Kgz(),2):(V=t.S)?t.return(V.delete("yt-player-local-img")):t.return(!0)})},GA=function(V){var t,x;
return g.Q(function(u){if(u.J==1)return g.m(u,Kgz(),2);if(u.J!=3){t=u.S;if(!t)throw Error("Cache API not supported");return V.length?g.m(u,t.open("yt-player-local-img"),3):u.return()}x=u.S;return g.m(u,Promise.all(V.map(function(Z){return x.delete(Z)})),0)})},IU=function(V){var t,x;
return g.Q(function(u){if(u.J==1)return g.m(u,Kgz(),2);if(u.J!=3){t=u.S;if(!t)throw Error("Cache API not supported");return V.length?g.m(u,t.open("yt-player-local-img"),3):u.return()}x=u.S;return g.m(u,x.addAll(V),0)})},vC=function(V,t,x,u,Z){var P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl;
return g.Q(function(uz){switch(uz.J){case 1:return P=g.si(V,"mainVideoEntity"),K=g.si(V,"ytMainChannelEntity"),R=g.si(V,"transfer"),f=g.si(V,"videoDownloadContextEntity"),g.m(uz,CT(t,{mode:"readonly",LI:!0},function(Nt){return g.Ye.all([jd(Nt,P,"mainVideoEntity"),jd(Nt,K,"ytMainChannelEntity"),jd(Nt,R,"transfer"),jd(Nt,f,"videoDownloadContextEntity"),lO(Nt,"ytMainChannelEntity"),lO(Nt,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=uz.S;E=g.G(b);k=E.next().value;O=E.next().value;N=E.next().value;p=E.next().value;I=E.next().value;L=E.next().value;M=k;z=O;Y=N;r=p;n=I;U=L;if(!M&&!z){uz.FX(3);break}d=M?NG(M.thumbnail):[];if(!z){uL=[];uz.FX(4);break}return g.m(uz,I5j(z,n),5);case 5:uL=uz.S;case 4:return q1=uL,g.m(uz,GA(d.concat(q1)),3);case 3:w=[];H=g.si(V,"downloadStatusEntity");C=g.G(U);for(S=C.next();!S.done;S=C.next())D=S.value,ws=g.Oi(D.key).entityId,Ic=AG(D),t_=g.Oi(Ic.action.entityKey).entityId,ws!==V&&t_!==V||OK(x,
D.actionProto)||w.push(D.key);return g.m(uz,CT(t,{mode:"readwrite",LI:!0},function(Nt){var F=w.map(function(X){return DR(Nt,X)});
F.push(DR(Nt,P,{Nw:!0}));F.push(DR(Nt,H,{Nw:!0}));return g.Ye.all(F)}),7);
case 7:Cl=(gs=r)==null?void 0:gs.offlineModeType,Z&&(RU(Z),Z.offlineModeType&&(Cl=Z.offlineModeType)),sK(Y,Cl),Kc(u,{entityKey:P,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pl(uz)}})},FgY=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt,F,X,B,a,W,tT,Pw,Kl,T,bL,s4,fl,mh,E$,yn,io;
return g.Q(function(Hw){switch(Hw.J){case 1:return Z=g.si(V,"mainPlaylistEntity"),P=g.si(V,"ytMainChannelEntity"),g.m(Hw,CT(t,{mode:"readonly",LI:!0},function(nR){return g.Ye.all([jd(nR,Z,"mainPlaylistEntity"),jd(nR,P,"ytMainChannelEntity"),lO(nR,"mainPlaylistEntity"),lO(nR,"mainDownloadsListEntity"),lO(nR,"ytMainChannelEntity"),lO(nR,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=Hw.S;R=g.G(K);f=R.next().value;b=R.next().value;E=R.next().value;k=R.next().value;O=R.next().value;N=R.next().value;p=f;I=b;L=E;M=k;z=O;Y=N;if(!p&&!I){Hw.FX(3);break}r=p?vg$(p):[];if(!I){n=[];Hw.FX(4);break}return g.m(Hw,I5j(I,z),5);case 5:n=Hw.S;case 4:return U=n,g.m(Hw,GA(r.concat(U)),3);case 3:d=[];uL=new Map;if(!p){Hw.FX(7);break}return g.m(Hw,Lg$(p,L,M),8);case 8:d=Hw.S;q1=g.G(d);for(w=q1.next();!w.done;w=q1.next())H=w.value,uL.set(H,{videoId:H,playlistId:V,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.m(Hw,CT(t,{mode:"readonly",LI:!0},function(nR){return g.Ye.all([lO(nR,"transfer"),lO(nR,"videoDownloadContextEntity")])}),9);
case 9:C=Hw.S;S=g.G(C);D=S.next().value;ws=S.next().value;Ic=D;t_=ws;gs=g.G(Ic);for(Cl=gs.next();!Cl.done;Cl=gs.next())uz=Cl.value,Nt=g.Oi(uz.key).entityId,(F=uL.get(Nt))&&uz&&(F.cotn=uz.cotn);X=g.G(t_);for(B=X.next();!B.done;B=X.next())a=B.value,W=g.Oi(a.key).entityId,(tT=uL.get(W))&&a&&(tT.offlineModeType=a.offlineModeType);case 7:Pw=[];Kl=g.G(Y);for(T=Kl.next();!T.done;T=Kl.next())bL=T.value,s4=g.Oi(bL.key).entityId,fl=AG(bL),s4!==V&&fl.rootActionId!==V||OK(x,bL.actionProto)||Pw.push(bL.key);mh=
g.si(V,"mainPlaylistEntity");return g.m(Hw,CT(t,{mode:"readwrite",LI:!0},function(nR){var bF=Pw.map(function(QW){return DR(nR,QW)});
bF.push(DR(nR,mh,{Nw:!0}));return g.Ye.all(bF)}),10);
case 10:if(!p){Hw.FX(0);break}d.reverse();if(!d){Hw.FX(0);break}E$=g.G(d);yn=E$.next();case 13:if(yn.done){Hw.FX(0);break}io=yn.value;return g.m(Hw,vC(io,t,x,u,uL.get(io)),14);case 14:yn=E$.next(),Hw.FX(13)}})},ggE=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O;
return g.Q(function(N){if(N.J==1)return Z=g.si("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),P=new Map,g.m(N,CT(V,{mode:"readwrite",LI:!0},function(p){var I=lO(p,"transfer"),L=lO(p,"offlineOrchestrationActionWrapperEntity"),M=lO(p,"videoDownloadContextEntity"),z=jd(p,Z,"mainDownloadsListEntity");return g.Ye.all([I,L,M,z]).then(function(Y){Y=g.G(Y);var r=Y.next().value;var n=Y.next().value;var U=Y.next().value;var d=Y.next().value;Y=M3z.map(function(q1){return vfr(p,q1)});
n=g.G(n);for(var uL=n.next();!uL.done;uL=n.next())uL=uL.value,OK(t,uL.actionProto)||Y.push(DR(p,uL.key,{Nw:!0}));d&&(d.downloads=[],Y.push(U_(p,d,"mainDownloadsListEntity")));if(U)for(U=g.G(U),d=U.next();!d.done;d=U.next())d=d.value,n=g.Oi(d.key).entityId,n=g.si(n,"transfer"),P.set(n,d.offlineModeType);return g.Ye.all(Y).then(function(){return r})})}),2);
K=N.S;R=g.G(K);for(f=R.next();!f.done;f=R.next())b=f.value,sK(b,P.get(b.key)),E=g.Oi(b.key).entityId,k={videoId:E,offlineDeleteReason:u,cotn:b.cotn,offlineModeType:P.get(b.key)},RU(k),O=g.si(E,"mainVideoEntity"),Kc(x,{entityKey:O,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(N,Ght(),0)})},vg$=function(V,t){var x=[];
if(V.thumbnailStyleData){V=g.G(V.thumbnailStyleData);for(var u=V.next();!u.done;u=V.next()){var Z=void 0,P=void 0,K=void 0;x=x.concat(NG((Z=u.value)==null?void 0:(P=Z.value)==null?void 0:(K=P.collageThumbnail)==null?void 0:K.coverThumbnail))}}t=NG(t);return x.concat(t)},Lg$=function(V,t,x){var u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1;
return g.Q(function(w){u=[];Z=new Set;if(x.length)for(P=g.G(x),K=P.next();!K.done;K=P.next())if(R=K.value,f=void 0,(f=R.downloads)==null?0:f.length)for(b=g.G(R.downloads),E=b.next();!E.done;E=b.next())k=E.value,k.videoItem&&(O=g.Oi(k.videoItem).entityId,Z.add(O));if(V.videos){N=g.G(V.videos);for(p=N.next();!p.done;p=N.next())I=p.value,L=JSON.parse(g.Oi(I).entityId),L.videoId&&!Z.has(L.videoId)&&u.push(L.videoId);M=g.G(t);for(z=M.next();!z.done;z=M.next())if(Y=z.value,Y.key!==V.key&&(r=Y.videos))for(n=
g.G(r),U=n.next();!U.done;U=n.next())d=U.value,uL=JSON.parse(g.Oi(d).entityId),uL.videoId&&(q1=u.indexOf(uL.videoId),q1!==-1&&u.splice(q1,1))}return w.return(u)})},I5j=function(V,t){var x,u,Z,P,K,R,f,b;
return g.Q(function(E){x=NG(V.avatar);u=g.G(t);for(Z=u.next();!Z.done;Z=u.next())if(P=Z.value,P.id!==V.id)for(K=g.G(NG(P.avatar)),R=K.next();!R.done;R=K.next())f=R.value,b=x.indexOf(f),b!==-1&&x.splice(b,1);return E.return(x)})},X1t=function(V){var t;
return g.Q(function(x){t=g.l(V.frameworkUpdates,Lc);return V.frameworkUpdates&&t?g.m(x,Tk$(t),0):x.return()})},BJr=function(V){var t;
if((t=V.onResponseReceivedActions)!=null&&t.length){var x;V=(x=g.l(g.l(V.onResponseReceivedActions[0],zws),g.CzU))==null?void 0:x.actions;if(V!=null&&V.length)return V}},msU=function(V){var t,x,u;
return g.Q(function(Z){if(Z.J==1)return V?g.m(Z,hg(V,g.aA,"mainDownloadsListEntity"),2):Z.return([]);t=Z.S;return((x=t)==null?0:(u=x.downloads)==null?0:u.length)?Z.return(t.downloads.map(function(P){var K;return(K=P.videoItem)!=null?K:""})):Z.return([])})},Qos=function(V,t){var x;
return g.Q(function(u){return u.J==1?g.m(u,YTi(V,t),2):(x=u.S)?g.m(u,CT(V,{mode:"readwrite",LI:!0},function(Z){var P=[U_(Z,x.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];x.mainDownloadsListEntity&&P.push(U_(Z,x.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Ye.all(P)}),0):u.FX(0)})},YTi=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y;
return g.Q(function(r){if(r.J==1)return x=g.si("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.si("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(r,CT(V,{mode:"readonly",LI:!0},function(n){return g.Ye.all([jd(n,x,"mainDownloadsLibraryEntity"),jd(n,u,"mainDownloadsListEntity")])}),2);
Z=r.S;P=g.G(Z);K=P.next().value;R=P.next().value;f=K;b=R;f||(f={id:x});E=g.G(t);for(k=E.next();!k.done;k=E.next())if(O=k.value,O===g.aA){if(f.smartDownloadsList)return r.return();f.smartDownloadsList=O}else if(N=g.Oi(O).entityType,p={},N==="mainPlaylistEntity"?p.playlistItem=O:N==="mainVideoEntity"&&(p.videoItem=O),!g.YE(p)){I=void 0;if((I=b)==null?0:I.downloads){L=!1;M=g.G(b.downloads);for(z=M.next();!z.done;z=M.next())if(Y=z.value,Y.playlistItem===O||Y.videoItem===O){L=!0;break}L||b.downloads.push(p)}else b=
{id:u,downloads:[p]};f.downloadsList=u}return r.return({mainDownloadsLibraryEntity:f,mainDownloadsListEntity:b})})},a57=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L;
return g.Q(function(M){if(M.J==1)return x=g.si("main_downloads_library_id","mainDownloadsLibraryEntity"),u=g.si("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(M,CT(V,{mode:"readonly",LI:!0},function(z){return g.Ye.all([jd(z,x,"mainDownloadsLibraryEntity"),jd(z,u,"mainDownloadsListEntity"),jd(z,g.aA,"mainDownloadsListEntity")])}),2);
Z=M.S;P=g.G(Z);K=P.next().value;R=P.next().value;f=P.next().value;b=K;E=R;k=f;if(!b)return M.FX(0);if(t===g.aA&&((O=k)==null?0:O.downloads))k.downloads=[];else if((N=E)==null?0:N.downloads)for(p=g.Oi(t).entityType,I=0;I<E.downloads.length;I++)if(L=E.downloads[I],p==="mainVideoEntity"&&L.videoItem===t){E.downloads.splice(I,1);break}else if(p==="mainPlaylistEntity"&&L.playlistItem===t){E.downloads.splice(I,1);break}return g.m(M,CT(V,{mode:"readwrite",LI:!0},function(z){var Y=[U_(z,b,"mainDownloadsLibraryEntity")];
E&&Y.push(U_(z,E,"mainDownloadsListEntity"));k&&Y.push(U_(z,k,"mainDownloadsListEntity"));return g.Ye.all(Y)}),0)})},F7=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O;
return g.Q(function(N){if(N.J==1)return x=g.si(t,"transfer"),u=g.si(t,"videoDownloadContextEntity"),g.m(N,CT(V,{mode:"readonly",LI:!0},function(p){return g.Ye.all([jd(p,x,"transfer"),jd(p,u,"videoDownloadContextEntity")])}),2);
Z=N.S;P=g.G(Z);K=P.next().value;R=P.next().value;f=K;b=R;O={videoId:t,cotn:(E=f)==null?void 0:E.cotn,offlineModeType:(k=b)==null?void 0:k.offlineModeType};return N.return(O)})},MG=function(V,t,x,u,Z){var P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL;
return g.Q(function(q1){switch(q1.J){case 1:return P=g.si(V,"musicTrack"),K=g.si(V,"transfer"),g.m(q1,CT(t,{mode:"readonly",LI:!0},function(w){return g.Ye.all([jd(w,P,"musicTrack"),jd(w,K,"transfer"),lO(w,"musicTrack"),lO(w,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=q1.S;f=g.G(R);b=f.next().value;E=f.next().value;k=f.next().value;O=f.next().value;N=b;p=E;I=k;L=O;if(!N){q1.FX(3);break}return g.m(q1,ro7(N,I),4);case 4:return M=q1.S,g.m(q1,GA(M),3);case 3:z=[];Y=g.G(L);for(r=Y.next();!r.done;r=Y.next())n=r.value,U=g.Oi(n.key).entityId,d=AG(n),uL=g.Oi(d.action.entityKey).entityId,U!==V&&uL!==V||OK(x,n.actionProto)||z.push(n.key);return g.m(q1,CT(t,{mode:"readwrite",LI:!0},function(w){var H=z.map(function(C){return DR(w,C)});
H.push(DR(w,P,{Nw:!0}));return g.Ye.all(H)}),6);
case 6:sK(p),Z&&RU(Z),Kc(u,{entityKey:P,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pl(q1)}})},gc=function(V,t,x,u,Z){var P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt,F,X,B;
return g.Q(function(a){switch(a.J){case 1:return P=g.si(V,t),K=g.si("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(a,CT(x,{mode:"readonly",LI:!0},function(W){return g.Ye.all([jd(W,P,t),jd(W,K,"musicDownloadsLibraryEntity"),lO(W,t),lO(W,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=a.S;f=g.G(R);b=f.next().value;E=f.next().value;k=f.next().value;O=f.next().value;N=b;p=E;I=k;L=O;if(!N){a.FX(3);break}return g.m(a,ro7(N,I),4);case 4:return M=a.S,g.m(a,GA(M),3);case 3:z=[];Y=new Map;if(!N){a.FX(6);break}return g.m(a,TJY(N,I,p),7);case 7:z=a.S;r=g.G(z);for(n=r.next();!n.done;n=r.next())U=n.value,d=g.Oi(U).entityId,Y.set(d,{videoId:d,playlistId:V,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.m(a,w6(x,"transfer"),8);case 8:for(uL=a.S,q1=g.G(uL),
w=q1.next();!w.done;w=q1.next())H=w.value,C=g.Oi(H.key).entityId,(S=Y.get(C))&&H&&(S.cotn=H.cotn);case 6:D=[];ws=g.G(L);for(Ic=ws.next();!Ic.done;Ic=ws.next())t_=Ic.value,gs=g.Oi(t_.key).entityId,Cl=AG(t_),gs!==V&&Cl.rootActionId!==V||OK(u,t_.actionProto)||D.push(t_.key);uz=g.si(V,t);return g.m(a,CT(x,{mode:"readwrite",LI:!0},function(W){var tT=D.map(function(Pw){return DR(W,Pw)});
tT.push(DR(W,uz,{Nw:!0}));return g.Ye.all(tT)}),9);
case 9:if(!N){a.FX(0);break}z.reverse();if(!z.length){a.FX(0);break}Nt=g.G(z);F=Nt.next();case 12:if(F.done){a.FX(0);break}X=F.value;B=g.Oi(X).entityId;if(!B){a.FX(13);break}return g.m(a,MG(B,x,u,Z,Y.get(B)),13);case 13:F=Nt.next(),a.FX(12)}})},X7=function(V,t,x){var u,Z,P,K,R,f,b;
return g.Q(function(E){if(E.J==1)return g.m(E,CT(V,{mode:"readwrite",LI:!0},function(k){var O=lO(k,"transfer"),N=lO(k,"offlineOrchestrationActionWrapperEntity");return g.Ye.all([O,N]).then(function(p){p=g.G(p);var I=p.next().value;var L=p.next().value;p=Wgj.map(function(r){return vfr(k,r)});
L=g.G(L);for(var M=L.next();!M.done;M=L.next()){M=M.value;var z=g.Oi(M.actionProto.entityKey).entityType==="musicTrack",Y=M.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";OK(t,M.actionProto)||z&&(!z||Y)||p.push(DR(k,M.key,{Nw:!0}))}return g.Ye.all(p).then(function(){return I})})}),2);
u=E.S;Z=g.G(u);for(P=Z.next();!P.done;P=Z.next())K=P.value,sK(K),R=g.Oi(K.key).entityId,f={videoId:R,offlineDeleteReason:void 0,cotn:K.cotn},RU(f),b=g.si(R,"musicTrack"),Kc(x,{entityKey:b,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(E,Ght(),0)})},ogj=function(V){for(var t,x=g.G(V.additionalMetadatas),u=x.next();!u.done;u=x.next())u=u.value,u.offlineMusicVideoData&&(t=u.offlineMusicVideoData);
var Z,P,K,R,f;return{id:g.si(V.videoId,"musicTrack"),videoId:V.videoId,title:V.title,thumbnailDetails:V.thumbnail,lengthMs:String(Number(V.lengthSeconds)*1E3),albumTitle:(Z=t)==null?void 0:Z.releaseTitle,musicVideoType:(P=t)==null?void 0:P.musicVideoType,contentRating:{explicitType:(K=t)==null?void 0:K.explicitType},artistNames:((R=t)==null?void 0:R.byline)||((f=t)==null?void 0:f.channelName),downloadMetadata:g.si(V.videoId,"musicTrackDownloadMetadataEntity")}},TJY=function(V,t,x){var u,Z,P,K,R,f,
b,E,k,O,N,p,I,L,M,z,Y,r;
return g.Q(function(n){u=[];Z=new Set;if((P=x)==null?0:(K=P.downloadedTracks)==null?0:K.length)for(R=g.G(x.downloadedTracks),f=R.next();!f.done;f=R.next())b=f.value,Z.add(b);if(V.tracks){E=g.G(V.tracks);for(k=E.next();!k.done;k=E.next())O=k.value,Z.has(O)||u.push(O);N=g.G(t);for(p=N.next();!p.done;p=N.next())if(I=p.value,I.id!==V.id&&(L=I.tracks))for(M=g.G(L),z=M.next();!z.done;z=M.next())Y=z.value,r=u.indexOf(Y),r!==-1&&u.splice(r,1)}return n.return(u)})},ro7=function(V,t){var x,u,Z,P,K,R,f,b;
return g.Q(function(E){x=NG(V.thumbnailDetails);u=g.G(t);for(Z=u.next();!Z.done;Z=u.next())if(P=Z.value,P.id!==V.id)for(K=g.G(NG(P.thumbnailDetails)),R=K.next();!R.done;R=K.next())f=R.value,b=x.indexOf(f),b!==-1&&x.splice(b,1);return E.return(x)})},ngF=function(V,t){var x,u,Z,P,K,R,f,b,E;
return g.Q(function(k){if(k.J==1)return x=g.si("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(k,hg(V,x,"musicDownloadsLibraryEntity"),2);(u=k.S)||(u={id:x});Z=g.Oi(t).entityType;Z==="musicTrack"?(P=u.downloadedTracks)!=null&&P.includes(t)||(u.downloadedTracks=((K=u.downloadedTracks)!=null?K:[]).concat(t)):Z==="musicPlaylist"?(R=u.downloadedPlaylists)!=null&&R.includes(t)||(u.downloadedPlaylists=((f=u.downloadedPlaylists)!=null?f:[]).concat(t)):Z!=="musicAlbumRelease"||(b=u.downloadedAlbumReleases)!=
null&&b.includes(t)||(u.downloadedAlbumReleases=((E=u.downloadedAlbumReleases)!=null?E:[]).concat(t));return g.m(k,Jg(V,u,"musicDownloadsLibraryEntity"),0)})},coU=function(V,t){var x,u,Z,P,K,R,f;
return g.Q(function(b){if(b.J==1)return x=g.si("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(b,hg(V,x,"musicDownloadsLibraryEntity"),2);u=b.S;if(!u)return b.FX(0);Z=g.Oi(t).entityType;Z==="musicTrack"?P=u.downloadedTracks:Z==="musicPlaylist"&&(P=u.downloadedPlaylists);if((K=P)==null?0:K.length)for(R=0;R<P.length;R++)if(f=P[R],f===t){P.splice(R,1);break}return g.m(b,Jg(V,u,"musicDownloadsLibraryEntity"),0)})},yor=function(V){var t=V.videos;
V=[];var x=[];if(t){t=g.G(t);for(var u=t.next();!u.done;u=t.next()){var Z=u.value.offlineVideoData.videoId;u=g.si(Z,"musicTrack");Z=g.si(Z,"musicTrackDownloadMetadataEntity");V.push(u);x.push(Z)}}return{xO:V,dY:x}},zA=function(V,t,x){t={track:ogj(t)};
x&&(t.playlistId=x);if(V=g.l(V.actionMetadata,jo_))t.maximumDownloadQuality=V.maximumDownloadQuality;return{musicTrackEntityActionMetadata:t}},HIE=function(V){var t,x,u,Z,P,K,R,f;
return g.Q(function(b){switch(b.J){case 1:return t=g.iM(),x=Hkc(V),u=g.St(l5i),g.AT(b,2),P={xl:!0},g.m(b,g.uM(t,x,u,void 0,P),4);case 4:Z=b.S;g.GK(b,3);break;case 2:K=g.I9(b);if(K instanceof g.bM)throw R="GetOffline network manager error: "+K.message,Zm(R,K),Error(R);Zm("GetOffline fetch request error",K);throw Error("GetOffline fetch request error");case 3:f=BC(Z);if(!Z)throw Zm("Network request failed"),Error("Network request failed");if(f!==void 0)m4(f);else if(!Z.videos||!Z.videos.length)throw Zm("No data"),
Error("No data");return b.return(Z.videos.map(function(E){return E.offlineVideoData}))}})},UsE=function(V){var t,x,u,Z,P,K,R,f;
return g.Q(function(b){switch(b.J){case 1:return t=g.iM(),x=Uq_(V),u=g.St(l5i),g.AT(b,2),P={xl:!0},g.m(b,g.uM(t,x,u,void 0,P),4);case 4:Z=b.S;g.GK(b,3);break;case 2:K=g.I9(b);if(K instanceof g.bM)throw R="GetOffline network manager error for playlist: "+K.message,Zm(R,K),Error(R);Zm("GetOffline fetch request error for playlist",K);throw Error("GetOffline fetch request error for playlist");case 3:f=BC(Z);if(!Z)throw Zm("Network request failed for playlist"),Error("Network request failed for playlist");
if(f!==void 0)m4(f,"playlist");else if(!Z.playlists||!Z.playlists.length)throw Zm("No data for playlist"),Error("No data for playlist");return b.return(Z.playlists.map(function(E){return E.offlinePlaylistData}))}})},ewr=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_;
return g.Q(function(gs){switch(gs.J){case 1:return g.m(gs,VH(),2);case 2:Z=gs.S;if(!Z)return gs.return([]);P=[];if((K=u)==null?0:K.length){P=u;gs.FX(3);break}return g.m(gs,w6(Z,"mainPlaylistEntity"),4);case 4:P=gs.S;case 3:if(!P.length)return gs.return([]);R=[];f=Date.now()/1E3;b=g.G(P);E=b.next();case 5:if(E.done)return R.length?g.m(gs,Dsn(R),10):gs.return([]);k=E.value;if(!k.downloadState){O=void 0;gs.FX(8);break}return g.m(gs,hg(Z,k.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:O=
gs.S;case 8:N=O;p=void 0;L=(I=(p=k)==null?void 0:p.entityMetadata)&&I.nextAutoRefreshIntervalSeconds?Number(I.nextAutoRefreshIntervalSeconds):NaN;M=Number.isNaN(L)?V:L;Y=z=void 0;r=((z=N)==null?0:z.lastSyncedTimestampMillis)?Number((Y=N)==null?void 0:Y.lastSyncedTimestampMillis)/1E3:0;U=n=void 0;d=((n=N)==null?0:n.addedTimestampMillis)?Number((U=N)==null?void 0:U.addedTimestampMillis)/1E3:0;if(x||!I||r+M<=f){uL=[];q1=void 0;if((q1=k.videos)==null?0:q1.length)for(w=g.G(k.videos),H=w.next();!H.done;H=
w.next())C=H.value,S=JSON.parse(g.Oi(C).entityId),S.videoId&&uL.push(S.videoId);D="0";I&&(ws=void 0,D=String(Number((ws=I.offlineLastModifiedTimestampSeconds)!=null?ws:0).toFixed()));Ic={playlistId:k.playlistId,videoIds:uL,offlineLastModifiedTimestamp:D,autoSync:t,offlineDateAddedTimestamp:String(d.toFixed())};R.push(Ic)}E=b.next();gs.FX(5);break;case 10:return t_=gs.S,gs.return(t_)}})},dsn=function(){var V,t,x,u,Z;
return g.Q(function(P){if(P.J==1)return g.m(P,VH(),2);if(P.J!=3)return(V=P.S)?g.m(P,w6(V,"refresh"),3):P.return(!1);t=P.S;if((x=t[0])==null||!x.refreshTime)return P.return(!1);u=Number(t[0].refreshTime);Z=Date.now()/1E3;return P.return(isFinite(u)&&Z>=u)})},JoE=function(V,t){var x,u,Z;
return g.Q(function(P){switch(P.J){case 1:return g.AT(P,2),g.m(P,Cbr(V,t),4);case 4:return u=P.S,g.m(P,X1t(u),5);case 5:x=BJr(u);g.GK(P,3);break;case 2:Z=g.I9(P),Zm("getAndProcessSmartDownloadsResponse request or processing error",Z);case 3:return P.return(x)}})},hw$=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_;
return g.Q(function(gs){switch(gs.J){case 1:return g.m(gs,VH(),2);case 2:Z=gs.S;if(!Z)return gs.return([]);P=[];if((K=u)==null?0:K.length){P=u;gs.FX(3);break}return g.m(gs,w6(Z,"musicPlaylist"),4);case 4:P=gs.S;case 3:if(!P.length)return gs.return([]);R=[];f=Date.now()/1E3;b=g.G(P);E=b.next();case 5:if(E.done)return R.length?g.m(gs,Dsn(R),10):gs.return([]);k=E.value;O=void 0;p=(N=(O=k)==null?void 0:O.entityMetadata)&&N.nextAutoRefreshIntervalSeconds?Number(N.nextAutoRefreshIntervalSeconds):NaN;I=
Number.isNaN(p)?V:p;M=L=0;z="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!k.downloadMetadata){gs.FX(8);break}return g.m(gs,hg(Z,k.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:Y=gs.S,n=r=void 0,L=Number((n=(r=Y)==null?void 0:r.addedTimestampMillis)!=null?n:"0")/1E3,d=U=void 0,M=Number((d=(U=Y)==null?void 0:U.lastModifiedTimestampMillis)!=null?d:"0")/1E3,q1=uL=void 0,z=(q1=(uL=Y)==null?void 0:uL.syncState)!=null?q1:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:w=void 0;if(x||z!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!N||Number((w=N.lastSyncedTimestampSeconds)!=null?w:0)+I<=f){H=[];C=void 0;if((C=k.tracks)==null?0:C.length)for(S=g.G(k.tracks),D=S.next();!D.done;D=S.next())ws=D.value,H.push(g.Oi(ws).entityId);Ic={playlistId:k.playlistId,videoIds:H,offlineLastModifiedTimestamp:String(M.toFixed()),autoSync:t,offlineDateAddedTimestamp:String(L.toFixed())};R.push(Ic)}E=b.next();gs.FX(5);break;case 10:return t_=gs.S,gs.return(t_)}})},Cbr=function(V,t){var x,u,Z,P,K,R,f,b,E,k;
return g.Q(function(O){switch(O.J){case 1:return x=g.iM(),g.m(O,VH(),2);case 2:u=O.S;if(!u){O.FX(3);break}return g.m(O,wRs(u),4);case 4:Z=O.S;case 3:var N=Z;P={context:g.K4(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:V},offlineClientState:N,clientStateRequestData:{preferredFormatType:t}}}};K=g.St(w1E);g.AT(O,5);f={xl:!0};return g.m(O,g.uM(x,P,K,void 0,f),7);case 7:R=O.S;g.GK(O,6);break;case 5:b=g.I9(O);if(b instanceof g.bM)throw E=
"DPS network manager error for smart downloads: "+b.message,Zm(E,b),Error(E);Zm("DPS fetch request error for smart downloads",b);throw Error("DPS fetch request error for smart downloads");case 6:k=BC(R);if(R)k!==void 0&&m4(k,"smart downloads");else throw Zm("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return O.return(R)}})},tUF=function(V,t){var x,u,Z,P,K,R,f,b;
return g.Q(function(E){switch(E.J){case 1:return x=g.iM(),u={context:g.K4(),videoPlaybackPositionEntities:V,lastSyncTimestampUsec:t},Z=g.St(VUE),g.AT(E,2),K={xl:!0},g.m(E,g.uM(x,u,Z,void 0,K),4);case 4:P=E.S;g.GK(E,3);break;case 2:R=g.I9(E);if(R instanceof g.bM)throw f="VPPS network manager error: "+R.message,Zm(f,R),Error(f);Zm("VPPS fetch request error",R);throw Error("VPPS fetch request error");case 3:b=BC(P);if(P)b!==void 0&&m4(b,"position sync");else throw Zm("Network request failed for position sync"),
Error("Network request failed for position sync");return E.return(P)}})},uR7=function(V,t,x){var u,Z,P,K,R,f,b,E;
return g.Q(function(k){switch(k.J){case 1:u=g.iM();var O=x.refreshData,N=x.isEnqueuedForExpiredStreamUrlRefetch,p=x.WV,I=x.offlineSourceData,L=x.mediaCapabilities,M={entityKey:V};O&&(M.refreshData=O);N&&(M.isExpiredStreamUrlRefetch=N);p&&(M.downloadParameters=p);I&&(M.offlineSourceData=I);O={context:g.Zf(t),signatureTimestamp:20115,videos:[M]};L&&(O.mediaCapabilities=L);Z=O;P=g.St(xrr);g.AT(k,2);R={xl:!0};return g.m(k,g.uM(u,Z,P,void 0,R),4);case 4:K=k.S;g.GK(k,3);break;case 2:f=g.I9(k);if(f instanceof
g.bM)throw b="GetPDE network manager error: "+f.message,Zm(b,f),Error(b);Zm("GetPDE fetch request error",f);throw Error("GetPDE fetch request error");case 3:E=BC(K);if(K)E!==void 0&&m4(E,"PDE");else throw Zm("Network request failed for PDE"),Error("Network request failed for PDE");return k.return(K)}})},BC=function(V){var t;
return(t=V.errorMetadata)==null?void 0:t.status},m4=function(V,t){t=t?" for "+t:"";
if(V===0)throw V="Empty response body"+t,Zm(V),Error(V);V="Response with error"+t;Zm(V);throw Error(V);},Dsn=function(V){var t,x,u,Z,P,K,R,f;
return g.Q(function(b){switch(b.J){case 1:return t=g.iM(),x=Dqc(V),u=g.St(Z3_),g.AT(b,2),P={xl:!0},g.m(b,g.uM(t,x,u,void 0,P),4);case 4:Z=b.S;g.GK(b,3);break;case 2:K=g.I9(b);if(K instanceof g.bM)throw R="offlinePlaylistSyncCheck network manager error: "+K.message,Zm(R,K),Error(R);Zm("offlinePlaylistSyncCheck fetch request error",K);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:f=BC(Z);if(!Z)throw Zm("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(f!==void 0)m4(f,"playlist sync");else if(!Z.offlinePlaylistSyncCheckDatas||!Z.offlinePlaylistSyncCheckDatas.length)throw Zm("No data for playlist sync"),Error("No data for playlist sync");return b.return(Z.offlinePlaylistSyncCheckDatas.map(function(E){return E.offlinePlaylistSyncCheckData}))}})},Y3=function(V){this.J=V},PZF=function(V,t){var x,u,Z,P,K,R;
return g.Q(function(f){switch(f.J){case 1:x=new Map,u=g.G(t),Z=u.next();case 2:if(Z.done){f.FX(4);break}P=Z.value;K=x;R=K.set;return g.m(f,V.S(P),5);case 5:R.call(K,P,f.S);Z=u.next();f.FX(2);break;case 4:return f.return(x)}})},QH=function(V,t,x,u,Z,P){t=g.si(t,x);
u=Object.assign({},P,{priority:u,retryScheduleIntervalsInSeconds:Z});return{actionType:V,entityKey:t,actionMetadata:u}},aU=function(V,t,x,u,Z,P){this.status=V;
this.J=t;this.W=x;this.S=u;this.N=Z;this.downloadState=P},KVn=function(V,t,x){this.J=V;
this.Rj=t;this.N=x},fLs=function(V,t){var x,u,Z,P,K,R,f,b,E;
return g.Q(function(k){switch(k.J){case 1:return x=t.entityKey,Z=(u=g.l(t.actionMetadata,rc))==null?void 0:u.isEnqueuedForExpiredStreamUrlRefetch,g.AT(k,2),P=void 0,g.m(k,qR7(V,t),4);case 4:P=k.S;g.AT(k,5);var O=(O=g.l(t.actionMetadata,rc))?{maximumDownloadQuality:O.maximumDownloadQuality}:void 0;return g.m(k,uR7(x,V.Rj,{isEnqueuedForExpiredStreamUrlRefetch:Z,WV:O,offlineSourceData:P}),7);case 7:K=k.S;g.GK(k,6,2);break;case 5:return g.I9(k,2),R=$3(t)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Zm("PDE handleAdd error"),k.return(TA(t,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",R,"DOWNLOAD_STATE_FAILED"));case 6:return g.m(k,R9r(V,K,t),8);case 8:return k.return(TA(t,!0,K.orchestrationActions));case 2:return f=g.I9(k),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.FM&&f.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Zm("PDE handleAdd error"),k.return(TA(t,!1,void 0,b,E,"DOWNLOAD_STATE_FAILED"))}})},EsU=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1;
return g.Q(function(w){switch(w.J){case 1:return x=t.entityKey,u=g.Oi(x).entityId,g.m(w,CT(V.J,{mode:"readonly",LI:!0},function(H){var C=jd(H,x,"playbackData"),S=jd(H,g.si(u,"offlineVideoPolicy"),"offlineVideoPolicy");H=jd(H,g.si(u,"transfer"),"transfer");return g.Ye.all([C,S,H])}),2);
case 2:Z=w.S;P=g.G(Z);K=P.next().value;R=P.next().value;f=P.next().value;b=K;E=R;k=f;if(!b||!E)return w.return(TA(t,!0));O=[];I=((p=b)==null?0:p.playerResponseJson)?JSON.parse(b.playerResponseJson):null;if(!(k&&I&&V.Rj.T("html5_refresh_deprecated_downloads"))){w.FX(3);break}N=$rs(V,I,k);return g.m(w,b3s(V,k),4);case 4:O=w.S;case 3:L={lastPlayerResponseTimestampSeconds:b.playerResponseTimestamp,offlineToken:E.offlineToken,formatIds:O};M={};if((z=k)==null?0:z.maximumDownloadQuality)M.maximumDownloadQuality=
k.maximumDownloadQuality;g.AT(w,5);Y=void 0;return g.m(w,qR7(V,t),7);case 7:return Y=w.S,g.AT(w,8),g.m(w,uR7(x,V.Rj,{refreshData:L,WV:M,offlineSourceData:Y,mediaCapabilities:N}),10);case 10:r=w.S;g.GK(w,9,5);break;case 8:return g.I9(w,5),n=$3(t)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Zm("PDE handleRefresh error"),w.return(TA(t,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",n,"DOWNLOAD_STATE_FAILED"));
case 9:return g.m(w,R9r(V,r,t),11);case 11:return w.return(TA(t,!0,r.orchestrationActions));case 5:return U=g.I9(w),d="PDE handleRefresh error",U instanceof Error&&(d="PDE handleRefresh error: "+U.message),uL="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q1="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.FM&&U.type==="QUOTA_EXCEEDED"&&(uL="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q1="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Zm(d),w.return(TA(t,
!1,void 0,uL,q1,"DOWNLOAD_STATE_FAILED"))}})},qR7=function(V,t){var x,u,Z,P;
return g.Q(function(K){if(K.J==1)return x=g.Oi(t.entityKey).entityId,u=g.si(x,"videoDownloadContextEntity"),g.m(K,hg(V.J,u,"videoDownloadContextEntity"),2);Z=K.S;return(P=Z)!=null&&P.offlineModeType?K.return({offlineModeType:Z.offlineModeType}):K.return(void 0)})},R9r=function(V,t,x){var u,Z,P,K,R;
return g.Q(function(f){if(f.J==1){if(!t.frameworkUpdates||!g.l(t.frameworkUpdates,Lc))return f.return();if(!(g.l(t.frameworkUpdates,Lc).mutations&&g.l(t.frameworkUpdates,Lc).mutations.length>0&&g.l(t.frameworkUpdates,Lc).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return f.FX(2);u=g.Oi(g.l(t.frameworkUpdates,Lc).mutations[0].entityKey).entityId;return g.m(f,F7(V.J,u),3)}if(f.J!=2){Z=f.S;P=g.l(x.actionMetadata,rc);if(R=(K=P)==null?void 0:K.playlistId)Z.playlistId=R;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.J2(V.Rj)?g.m(f,vC(u,V.J,x,V.N,Z),2):g.Dp(V.Rj)?g.m(f,MG(u,V.J,x,V.N),2):f.FX(2)}return g.m(f,Tk$(g.l(t.frameworkUpdates,Lc)),0)})},TA=function(V,t,x,u,Z,P){return new aU(t?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",$3(V),x,u,Z,P)},$rs=function(V,t,x){t=Aor(V.Rj,x.cotn,t);
x=g.RK(t);return g.BXl(t,x,V.Rj)},b3s=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O;
return g.Q(function(N){if(N.J==1)return x=[],g.m(N,CT(V.J,{mode:"readonly",LI:!0},function(p){var I=[],L=t.offlineVideoStreams;if(L){L=g.G(L);for(var M=L.next();!M.done;M=L.next())I.push(jd(p,M.value,"offlineVideoStreams"))}return g.Ye.all(I)}),2);
if(u=N.S)for(Z=g.G(u),P=Z.next();!P.done;P=Z.next())if(K=P.value,R=void 0,(R=K)==null?0:R.streamsProgress)for(f=K.streamsProgress,b=0;b<f.length;b++)E=f[b],k=JSON.parse(E.formatStreamBytes),O={itag:k.itag,lmt:k.lastModified,xtags:k.xtags},x.push(O);return N.return(x)})},kXU=function(V,t){this.J=V;
this.Rj=t},i3U=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N;
return g.Q(function(p){switch(p.J){case 1:return x=$3(t),g.m(p,w6(V.J,"videoPlaybackPositionEntity"),2);case 2:u=p.S;if(u.length===0)return p.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.AT(p,3);return g.m(p,nT.getInstance(),5);case 5:Z=p.S;if(!Z)throw Error("prefStorage is undefined");return g.m(p,Z.get("psi"),6);case 6:return P=p.S,f=(R=(K=P)==null?void 0:K.uQ)!=null?R:"0",g.m(p,tUF(u,f),7);case 7:return b=p.S,E={isPaused:b.watchHistoryPaused,uQ:b.syncTimestampUsec},g.m(p,Z.set("psi",
E),8);case 8:if(E.isPaused){p.FX(9);break}k=g.l(b.frameworkUpdates,Lc);if(!b.frameworkUpdates||!k){p.FX(9);break}return g.m(p,Tk$(k),9);case 9:g.GK(p,4);break;case 3:return O=g.I9(p),N="PPE handleRefresh error: "+(O instanceof Error?O.message:"unknown error"),Zm(N),p.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},s17=function(V,t){var x,u,Z,P,K,R,f,b;
return g.Q(function(E){switch(E.J){case 1:return x=$3(t),u=g.Oi(t.entityKey).entityId,g.AT(E,2),g.m(E,nT.getInstance(),4);case 4:Z=E.S;if(!Z)throw Error("prefStorage is undefined");return g.m(E,Z.get("psi"),5);case 5:P=E.S;K=g.l(t.actionMetadata,O3s);if(((R=P)==null?void 0:R.isPaused)!==!1||(f=K)==null||!f.lastPlaybackPositionSeconds){E.FX(6);break}b={key:g.si(u,"videoPlaybackPositionEntity"),videoId:u,lastPlaybackPositionSeconds:K.lastPlaybackPositionSeconds};return g.m(E,Jg(V.J,b,"videoPlaybackPositionEntity"),
6);case 6:g.GK(E,3);break;case 2:return g.I9(E),E.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},Nmr=function(V,t){var x,u,Z;
return g.Q(function(P){switch(P.J){case 1:x=$3(t);g.AT(P,2);u=g.Oi(t.entityKey).entityId;if(u==="!*$_ALL_ENTITIES_!*$")return g.m(P,mqj(V.J),5);Z=g.si(u,"videoPlaybackPositionEntity");return g.m(P,Bk$(V.J,Z),5);case 5:g.GK(P,3);break;case 2:return g.I9(P),P.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},pas=function(V,t){this.api=V;
this.J=t;this.logger=new g.ZG("woffle");this.S=!1;this.Wk={VZ:this.VZ};this.logger.debug("Initialized OfflineMediaManager")},ARs=function(V){return g.Q(function(t){return t.return(lyj(V))})},SRr=function(V){var t;
return g.Q(function(x){if(x.J==1)return g.m(x,g.Jr4(V),2);t=x.S;return x.return(t.filter(function(u){return!!u.url}).map(function(u){return u.url}))})},WC=function(V,t){var x=g.Bi(t);
if(x===1||x===0)return Promise.resolve();(x=GXi(V,t))&&x.stopVideo();V.N=0;return ARs(t)},oU=function(V,t,x,u){x=x===void 0?!1:x;
u=u===void 0?!0:u;var Z=typeof t==="string"?t:t.videoDetails.videoId;g.Bi(Z)===2&&((t=GXi(V,Z))?t.stopVideo():V.logger.info(function(){return"Corresponding player for "+Z+" not found. Pausing anyway"}),g.mr(Z,2),V.N=2,x?ILt(V.J):u&&vsn(V.J))},GXi=function(V,t){var x;
return((x=V.player)==null?void 0:x.getVideoData().videoId)===t?V.player:null},LVF=function(V,t,x){t.getPlayerResponse();
g.mr(t.videoId,2);V.N=2;V.S=!1;var u;(u=V.player)==null||u.dispose();V.player=V.api.LQ(9,t);t={};V.player.NB((t.localmediachange=V.VJ,t.signatureexpired=V.v8,t.statechange=V.SZs,t),V);var Z=V.VZ(x);V.player.Md(g.Pg(Z,Z,!0,"m"),!1);V.logger.debug(function(){return"Starting headless playback with quality: "+Z});
V.player.lC(!1)},FVi=function(V,t){this.J=V;
this.Rj=t},gsE=function(V,t){var x,u;
return g.Q(function(Z){switch(Z.J){case 1:return x=$3(t),g.m(Z,hg(V.J,t.entityKey,"transfer"),2);case 2:if(u=Z.S)return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.AT(Z,3);return g.m(Z,MUt(V,t),5);case 5:g.GK(Z,4);break;case 3:return g.I9(Z),Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},XaE=function(V,t){var x,u;
return g.Q(function(Z){switch(Z.J){case 1:return x=$3(t),g.m(Z,hg(V.J,t.entityKey,"transfer"),2);case 2:u=Z.S;if(!u||u.transferState!=="TRANSFER_STATE_COMPLETE")return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.AT(Z,3);return g.m(Z,MUt(V,t,!0),5);case 5:g.GK(Z,4);break;case 3:return g.I9(Z),Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},z9F=function(V,t){var x,u,Z,P,K,R,f,b,E,k;
return g.Q(function(O){switch(O.J){case 1:return x=$3(t),u=g.Oi(t.entityKey).entityId,g.m(O,CT(V.J,{mode:"readonly",LI:!0},function(N){var p=jd(N,t.entityKey,"transfer");N=jd(N,g.si(u,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Ye.all([p,N])}),2);
case 2:Z=O.S;P=g.G(Z);K=P.next().value;R=P.next().value;f=K;b=R;if(!f||f.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return O.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.AT(O,3);f.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.m(O,Jg(V.J,f,"transfer"),5);case 5:E=g.Oi(f.key).entityId;fc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:E,l9:f,offlineModeType:(k=b)==null?void 0:k.offlineModeType});g.GK(O,
4);break;case 3:return g.I9(O),O.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return O.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},MUt=function(V,t,x){x=x===void 0?!1:x;
var u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M;return g.Q(function(z){switch(z.J){case 1:return u=g.l(t.actionMetadata,Bmn),Z=g.Oi(t.entityKey).entityId,P=g.si(Z,"downloadStatusEntity"),g.m(z,CT(V.J,{mode:"readonly",LI:!0},function(Y){var r=jd(Y,P,"downloadStatusEntity");Y=jd(Y,g.si(Z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Ye.all([r,Y])}),2);
case 2:return K=z.S,R=g.G(K),f=R.next().value,b=R.next().value,E=f,k=b,O="TRANSFER_STATE_TRANSFER_IN_QUEUE",((N=E)==null?void 0:N.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(O="TRANSFER_STATE_PAUSED_BY_USER"),L={key:t.entityKey,transferState:O,cotn:g.m3(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(p=u)==null?void 0:p.maximumDownloadQuality,preferredAudioTrack:(I=u)==null?void 0:I.preferredAudioTrack,transferRetryCount:0,isRefresh:x,hasLoggedFirstStarted:!1},g.m(z,CT(V.J,
{mode:"readwrite",LI:!0},function(Y){var r=[];x&&r.push(DR(Y,g.si(Z,"offlineVideoStreams")));r.push(U_(Y,L,"transfer"));return g.Ye.all(r)}),3);
case 3:if(!x){z.FX(4);break}return g.m(z,ARs(Z),4);case 4:fc({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:Z,l9:L,offlineModeType:(M=k)==null?void 0:M.offlineModeType}),g.pl(z)}})},YR$=function(V,t,x,u){if(!V.action.entityKey)throw Error("entityKey is missing.");
var Z=g.Oi(V.action.entityKey);Z={entityType:Z.Aa,entityId:Z.entityId,offlineOrchestrationActionType:V.action.actionType,orchestrationAction:{orchestrationActionId:V.actionId}};t&&(Z.offlineOrchestrationActionResult=t.status,Z.isRetryable=x?!1:t.J,t.N&&(Z.offlineOrchestrationFailureReason=mrn(t.N,Z.isRetryable)));var P,K;if((P=V.action.actionMetadata)==null?0:(K=P.offlineLoggingData)==null?0:K.offlineModeType)Z.offlineModeType=V.action.actionMetadata.offlineLoggingData.offlineModeType;u&&(Z.additionalOrchestrationActions=
u.map(function(R){return{orchestrationActionId:R.actionId}}));
return Z},mrn=function(V,t){return V!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||t?V==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&t?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":V:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Q1$=function(V,t){var x={offlineOrchestrationContext:YR$(V)};
t=JXE(t,x);hRn(C57(),t,V.rootActionId)},aLE=function(V,t,x,u){u=u===void 0?[]:u;
t={offlineOrchestrationContext:YR$(V,t,x,u)};t=JXE(3,t);hRn(C57(),t,V.rootActionId)},rR_=function(){this.actions=[]},Tm7=function(V,t){t=g.G(t);
for(var x=t.next();!x.done;x=t.next())x=x.value,Q1$(x,1),V.actions.push(x);V.actions.sort(V.J)},WV7=function(V,t){if(t)for(var x=0;x<V.actions.length;x++)if(t==="!*$_ALL_ENTITIES_!*$"&&V.actions[x].actionId!==t||t!=="!*$_ALL_ENTITIES_!*$"&&V.actions[x].rootActionId===t&&V.actions[x].actionId!==t)V.actions.splice(x,1),x--},os_=function(V,t){V=g.G(V.actions);
for(var x=V.next();!x.done;x=V.next())if(x.value.actionId===t)return!0;return!1},nc=function(V,t,x,u,Z){g.c.call(this);
var P=this;this.S=V;this.zU=t;this.Ij=x;this.L=u;this.Rj=Z;this.J=new rR_;this.B=new g.um;this.N=new g.qK(function(){P.retry()});
this.C=NaN;this.G=!1;this.Wk={Zfs:function(){return P.J},
L0:function(){return P.B},
ysD:function(){return P.N},
retry:function(){return P.retry()}};
g.y(this,this.N);this.X=this.S.observe(this.wk.bind(this))},yRE=function(V,t,x,u,Z){var P;
return g.Q(function(K){if(K.J==1)return P=new nc(V,t,x,u,Z),g.m(K,nsY(P),2);cRY(P);return K.return(P)})},cRY=function(V){var t=V.J.actions[0];
return V.W?((t==null?void 0:t.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&V.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(V.G=!0),Promise.resolve()):j1_(V)},j1_=function(V){var t,x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M;
return g.Q(function(z){switch(z.J){case 1:if(V.W)throw Error("Already processing an action");if(V.uD())return z.return();t=V.J.actions.shift();bIi(V.Ij,!t);if(t===void 0)return z.return();t.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&t.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&WV7(V.J,t.actionId);x="";t.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&t.rootActionId===t.actionId&&(x=t.actionId);u=[t];V.W=u;if(Z=V.zU[t.entityType]){z.FX(2);break}V.W=
void 0;return g.m(z,j1_(V),3);case 3:return z.return();case 2:P=g.G(u);for(K=P.next();!K.done;K=P.next())R=K.value,Q1$(R,2);g.AT(z,4,5);return g.m(z,PZF(Z,u.map(function(Y){return Y.action})),7);
case 7:f=z.S,b=g.G(u),E=b.next();case 8:if(E.done){z.FX(10);break}k=E.value;O=f.get(k.action);return g.m(z,lLF(V,k,O),9);case 9:E=b.next();z.FX(8);break;case 10:WV7(V.J,x);case 5:g.vw(z);V.W=void 0;g.Ll(z,6);break;case 4:return N=g.I9(z),Zm("Orchestration error",N),g.AT(z,12),g.m(z,H3c(V,u),14);case 14:g.GK(z,5);break;case 12:p=g.I9(z);Zm("Orchestration retry error",p);I=g.G(u);for(L=I.next();!L.done;L=I.next())M=L.value,M.retryScheduleIndex<3&&Tm7(V.J,[M]);z.FX(5);break;case 6:return g.m(z,j1_(V),
0)}})},lLF=function(V,t,x){var u,Z,P,K,R,f,b,E,k,O,N,p;
return g.Q(function(I){switch(I.J){case 1:u=t.retryScheduleIndex+2===3;if(x.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){I.FX(2);break}if(x.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){I.FX(0);break}aLE(t,x,u);if(x.J&&t.retryScheduleIndex+1<3)return g.m(I,H3c(V,[t]),0);P=((Z=x)==null?0:Z.S)?x.S:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";K={entityKey:t.action.entityKey,failureReason:P};R=void 0;g.J2(V.Rj)?R="mainVideoDownloadStateEntity":g.Dp(V.Rj)&&(R="musicTrackDownloadMetadataEntity");
if(!R||!x.downloadState){I.FX(7);break}f=g.Oi(t.action.entityKey).entityId;return g.m(I,il(f,R,V.S,x.downloadState),7);case 7:Kc(V.L,K);if(x.downloadState==="DOWNLOAD_STATE_FAILED"&&V.Rj.T("html5_auto_retry_failed_pde_actions")){I.FX(0);break}Zm("Orchestration result is not retryable, deleting action");return g.m(I,Bk$(V.S,S4(t).key),0);case 2:b=void 0;try{b=(E=x.W)==null?void 0:E.map(function(L){return V.createAction(L,t)})}catch(L){return aLE(t,x,u),k={entityKey:t.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Kc(V.L,k),Zm("Orchestration subactions creation error",L),I.return()}aLE(t,x,u,b);if(!b){I.FX(12);break}O=b.map(function(L){return S4(L)});
N=0;case 13:if(!(N<b.length)||V.G){I.FX(15);break}return g.m(I,CT(V.S,{mode:"readwrite",LI:!0},function(L){var M=[];M.push(SIU(L,O.slice(N,N+10),"offlineOrchestrationActionWrapperEntity"));return g.Ye.all(M)}),16);
case 16:N+=10;I.FX(13);break;case 15:if(V.G)return V.G=!1,I.return();case 12:return p=S4(t),g.m(I,Bk$(V.S,p.key),17);case 17:Q1$(t,4),g.pl(I)}})},drs=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N;
return g.Q(function(p){x=[];u=Infinity;Z=4E3;P=g.G(t);for(K=P.next();!K.done;K=P.next())R=K.value,f=Number(R.enqueueTimeSec),b=Ur$(f),E=R.retryScheduleIndex,k=E!=null&&E>0,b>0&&k?(u=Math.min(u,f),Z=Math.min(b,Z)):x.push(R);isFinite(u)&&(!V.N.isActive()||u<V.C)&&(V.C=u,V.N.start(Z));V.B.U8()||(O=x.length,x=x.filter(function(I){var L;I=((L=I.actionProto)==null?void 0:L.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!DrU.includes(I)}),N=x.length<O,!V.N.isActive()&&N&&V.N.start(1));
x.length>0&&e9r(V,x);return g.m(p,cRY(V),0)})},JRE=function(V){var t,x,u,Z,P,K,R;
return g.Q(function(f){if(f.J==1)return g.m(f,CZF(V),2);t=f.S;x=[];u=g.G(t);for(Z=u.next();!Z.done;Z=u.next())P=Z.value,K=g.Oi(P.key),R=K.entityId,os_(V.J,R)||x.push(P);return g.m(f,drs(V,x),0)})},Ur$=function(V){V=V*1E3-Date.now();
return V>4E3?4E3:V},H3c=function(V,t){var x,u,Z;
return g.Q(function(P){x=g.G(t);for(u=x.next();!u.done;u=x.next()){Z=u.value;var K=void 0,R=void 0,f=((R=Z.action)==null?void 0:(K=R.actionMetadata)==null?void 0:K.retryScheduleIntervalsInSeconds)||[1,2,4];K=1;Z.retryScheduleIndex<f.length&&(K=f[Z.retryScheduleIndex]);Z.J=K*1E3+Date.now();Z.retryScheduleIndex++}return g.m(P,h9j(V,t),0)})},nsY=function(V){var t;
return g.Q(function(x){if(x.J==1)return g.m(x,w6(V.S,"offlineOrchestrationActionWrapperEntity"),2);t=x.S;return g.m(x,drs(V,t),0)})},e9r=function(V,t){t.length!==0&&t.forEach(function(x){x=AG(x);
x.retryScheduleIndex<3&&Tm7(V.J,[x])})},CZF=function(V,t){var x;
return g.Q(function(u){if(u.J==1)return g.m(u,w6(V.S,"offlineOrchestrationActionWrapperEntity",t),2);x=u.S;return u.return(x.filter(W9U))})},h9j=function(V,t){if(t.length===0)return Promise.resolve([]);
t=t.map(function(x){return S4(x)});
return zRj(V.S,t)},waE=function(V){this.A6=V;
this.J=void 0},Vgt=function(V,t){var x,u,Z,P;
return g.Q(function(K){x=t.videoId;u=!0;if(t.captionTracks.length)Z=SBj(t),V.J=new g.a7(V.A6,t,Z);else if(t.AZ)P=g.KOw(t),V.J=new g.Tx(V.A6,t.AZ,x,P,t.Ju,t.eventId),u=t.Ju;else return K.return();return K.return(new Promise(function(R){var f;(f=V.J)==null||f.f2({Ge:function(){return g.Q(function(b){if(b.J==1)return g.m(b,V.Ge(x,u),2);R();g.pl(b)})},
ZU:function(){}})}))})},tgF=function(V){var t;
return g.Q(function(x){if(x.J==1)return g.m(x,jQY(V),2);t=x.S;return x.return(!!t&&t.length>0)})},cC=function(V){g.c.call(this);
this.J=V;this.S=this.J.observe(this.N.bind(this))},xa_=function(V,t){var x,u,Z,P,K,R,f;
return g.Q(function(b){switch(b.J){case 1:if(t.length===0)return b.return([]);x=t.map(function(E){return g.si(E,"transfer")});
return g.m(b,w6(V.J,"transfer",x),2);case 2:u=b.S;Z=u.filter(W9U).map(function(E){return g.Oi(E.key).entityId});
P=t.filter(function(E){return Z.indexOf(E)===-1});
if(P.length===0)return b.return([]);K=g.G(P);R=K.next();case 3:if(R.done){b.FX(5);break}f=R.value;return g.m(b,ARs(f),4);case 4:R=K.next();b.FX(3);break;case 5:return b.return(P)}})},Phn=function(V,t,x,u,Z,P){var K,R,f;
return g.Q(function(b){K="STREAM_TYPE_UNKNOWN";x.video&&x.audio?(K="STREAM_TYPE_AUDIO_AND_VIDEO",Zm("unexpected stream type")):x.video&&!x.audio?K="STREAM_TYPE_VIDEO":!x.video&&x.audio&&(K="STREAM_TYPE_AUDIO");R=g.si(t,"offlineVideoStreams");f={numBytesDownloaded:Z.toFixed(),numTotalBytes:P.toFixed(),streamType:K,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(u),itag:K==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(x.itag):void 0};return g.m(b,CT(V,{mode:"readwrite",LI:!0},
function(E){var k=jd(E,R,"offlineVideoStreams"),O=jd(E,g.si(t,"transfer"),"transfer");return g.Ye.all([k,O]).then(function(N){N=g.G(N);var p=N.next().value;N=N.next().value;if(!N)return DR(E,R).then(function(){});
var I=uOj(p);p=ZKU(p,u,f,R);var L=U_(E,p,"offlineVideoStreams");uOj(p)>I&&(N.lastProgressTimeMs=Date.now().toString());I=[L];N.offlineVideoStreams||(N.offlineVideoStreams=[]);N.offlineVideoStreams.indexOf(R)===-1&&(N.offlineVideoStreams.push(R),I.push(U_(E,N,"transfer")));return g.Ye.all(I)})}),0)})},KKr=function(V,t){var x,u,Z,P,K;
return g.Q(function(R){if(R.J==1)return x=g.si(t,"offlineVideoStreams"),g.m(R,hg(V,x,"offlineVideoStreams"),2);u=R.S;if(!u||!u.streamsProgress)return R.return();Z=g.G(u.streamsProgress);for(P=Z.next();!P.done;P=Z.next())K=P.value,K.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",K.numTotalBytes!==K.numBytesDownloaded&&(K.numBytesDownloaded=K.numTotalBytes);return g.m(R,Jg(V,u,"offlineVideoStreams"),0)})},ZKU=function(V,t,x,u){if(V&&V.streamsProgress){u=V;
a:{t=t.itag+";"+t.xtags;for(var Z=V.streamsProgress,P=0;P<Z.length;P++){var K=JSON.parse(Z[P].formatStreamBytes);if(K.itag+";"+K.xtags===t){Z[P]=x;x=Z;break a}}Z.push(x);x=Z}u.streamsProgress=x}else V={key:u,streamsProgress:[x]};return V},uOj=function(V){if(V==null?0:V.streamsProgress){var t=0;
V=V.streamsProgress;for(var x=0;x<V.length;x++){var u=V[x];isNaN(Number(u.numBytesDownloaded))?Zm("stream progress bytes number invalid"):t+=Number(u.numBytesDownloaded)}return t}return 0},qqU=function(V,t,x,u){g.c.call(this);
var Z=this;this.S=V;this.api=t;this.dk=x;this.wk=u;this.B=new g.um;this.W=new g.qK(function(){Z.J&&Z.J.transferState==="TRANSFER_STATE_TRANSFERRING"&&Z.B.U8()&&((Z.J.transferRetryCount||0)<3?oU(Z.L,Z.G,!1,!1):WC(Z.L,Z.G.videoDetails.videoId),Z.ys("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Ij=this.Us=0;this.X=this.C=!1;this.xw=g.S7(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.L1=new g.j6(this);this.Wk={M4w:function(){return Z.W},
vlk:function(){return Z.wk},
L0:function(){return Z.B}};
this.zU=this.S.observe(this.MQ.bind(this));this.L=new pas(t,this);this.DS=new waE(t);this.cX=new cC(this.S);this.Es=this.B.listen("publicytnetworkstatus-online",this.Ff.bind(this));this.BX=this.B.listen("publicytnetworkstatus-offline",this.FsX.bind(this));this.X=this.api.K().T("html5_less_transfer_processing_logs");g.y(this,this.L1);this.L1.Z(t,"offlinetransferpause",this.UeC);g.J2(this.api.K())?this.N="mainVideoDownloadStateEntity":g.Dp(this.api.K())&&(this.N="musicTrackDownloadMetadataEntity")},
Rz$=function(V){return g.Q(function(t){if(t.J==1)t=g.m(t,cXc(),2);
else{var x=V.cX;var u=g.zQ();u=Object.keys(u);x=xa_(x,u);t=g.m(t,x,0)}return t})},j4=function(V,t){t=t===void 0?!1:t;
var x;return g.Q(function(u){if(u.J==1){if(V.J)throw Error("Already downloading a video");V.Ij=0;V.C=!1;return g.m(u,fNj(V),2)}return u.J!=4?(x=u.S,EgY(V.dk,!x),x&&V.B.U8()?t?g.m(u,new Promise(function(Z){g.FV(Z,1E3)}),4):u.FX(4):(!x&&V.J&&yH(V),u.FX(0))):g.m(u,$a7(V,x),0)})},bKU=function(V){return g.Q(function(t){if(t.J==1)return V.G?g.m(t,WC(V.L,V.G.videoDetails.videoId),3):t.FX(0);
yH(V);g.pl(t)})},Ex_=function(V,t){var x,u,Z;
return g.Q(function(P){switch(P.J){case 1:return g.AT(P,2),(x=!!t.captionTracks.length||!!t.AZ)?g.m(P,tgF(t.videoId),4):P.return();case 4:return(u=P.S)?P.return():g.m(P,Vgt(V.DS,t),5);case 5:g.GK(P,0);break;case 2:Z=g.I9(P),Zm("Caption downloading error",Z,t.cotn),g.pl(P)}})},$a7=function(V,t){var x,u,Z,P,K,R;
return g.Q(function(f){switch(f.J){case 1:if(V.C)return f.return();V.C=!0;V.J=t;x=g.Oi(V.J.key);u=x.entityId;Z=void 0;if(V.J.transferState==="TRANSFER_STATE_TRANSFERRING")return g.m(f,ll(V,u),7);if(V.J.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||V.J.transferRetryCount||V.J.hasLoggedFirstStarted){f.FX(3);break}return g.m(f,ll(V,u),5);case 5:return Z=f.S,V.J.hasLoggedFirstStarted=!0,g.m(f,kpt(V),6);case 6:khE({videoId:u,l9:V.J,offlineModeType:Z},void 0,void 0,!0);f.FX(3);break;case 7:Z=f.S,
fc({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:u,l9:V.J,offlineModeType:Z});case 3:return g.m(f,iKi(V),8);case 8:return P=null,g.AT(f,9),g.m(f,OKr(V,t),11);case 11:P=f.S;V.G=P;g.GK(f,10);break;case 9:return K=g.I9(f),Zm("error getting player response",K,t.cotn),g.m(f,V.ys("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return f.return();case 10:return R=Aor(V.api.K(),t.cotn,P),g.m(f,Ex_(V,R),13);case 13:return g.m(f,SRr(R.videoId),
14);case 14:R.hM=f.S,LVF(V.L,R,t.maximumDownloadQuality),V.W.start(108E5),g.pl(f)}})},fNj=function(V){var t,x;
return g.Q(function(u){if(u.J==1)return g.m(u,w6(V.S,"transfer"),2);t=u.S;x=t.filter(sy7).sort(N9c);return x.length===0?u.return():u.return(x[0])})},iKi=function(V){var t,x,u;
return g.Q(function(Z){if(Z.J==1){if(!V.J)return HC(V,"onTransferStart"),Z.return();V.W.start(108E5);return g.m(Z,UK(V,"TRANSFER_STATE_TRANSFERRING"),2)}t=V.J;return(u=((x=t)==null?0:x.key)?g.Oi(t.key).entityId:"")&&V.N?g.m(Z,il(u,V.N,V.S,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):Z.FX(0)})},ILt=function(V){var t,x,u,Z;
g.Q(function(P){switch(P.J){case 1:if(!V.J){HC(V,"onTransferPausedByUser");P.FX(2);break}t=V.J;V.W.stop();return g.m(P,UK(V,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:u=((x=t)==null?0:x.key)?g.Oi(t.key).entityId:"";if(!u||!V.N){P.FX(4);break}return g.m(P,il(u,V.N,V.S,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.m(P,ll(V,u),6);case 6:Z=P.S,iIr({videoId:u,l9:t,offlineModeType:Z});case 2:yH(V),j4(V),g.pl(P)}})},vsn=function(V){var t,x,u;
g.Q(function(Z){if(Z.J==1){if(!V.J)return HC(V,"onTransferPausedByNetwork"),Z.return();V.W.stop();return g.m(Z,UK(V,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(Z.J!=3)return t=V.J,(u=((x=t)==null?0:x.key)?g.Oi(t.key).entityId:"")&&V.N?g.m(Z,il(u,V.N,V.S,"DOWNLOAD_STATE_PAUSED"),3):Z.FX(3);yH(V);g.pl(Z)})},p2n=function(V){var t,x,u,Z,P;
g.Q(function(K){switch(K.J){case 1:if(!V.J)return HC(V,"onTransferComplete"),K.return();t=V.J;V.W.stop();if(!t||!V.G){K.FX(2);break}x=Aor(V.api.K(),t.cotn,V.G);return g.m(K,Ex_(V,x),2);case 2:return g.m(K,UK(V,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:Z=((u=t)==null?0:u.key)?g.Oi(t.key).entityId:"";if(!Z||!V.N){K.FX(5);break}return g.m(K,il(Z,V.N,V.S,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.m(K,KKr(V.S,Z),7);case 7:return g.m(K,ll(V,Z),8);case 8:P=K.S,fc({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:Z,l9:t,offlineModeType:P}),yH(V),j4(V),g.pl(K)}})},AJ_=function(V,t,x){var u,Z;
g.Q(function(P){switch(P.J){case 1:if(!V.J)return HC(V,"onTransferProgress: "+t),P.return();if(V.J.transferState==="TRANSFER_STATE_TRANSFERRING"){P.FX(2);break}return g.m(P,iKi(V),2);case 2:u=Date.now();if(!(u-V.Us>1E3)){P.FX(4);break}V.Us=u;return g.m(P,Phn(V.S,x.videoId,x.S,x.Yg,x.bytesDownloaded,x.J),5);case 5:if(V.X&&!(V.X&&u-V.Ij>V.xw)){P.FX(4);break}V.Ij=u;return g.m(P,ll(V,t),7);case 7:Z=P.S,khE({videoId:t,l9:V.J,offlineModeType:Z},x.bytesDownloaded,x.J);case 4:V.W.start(108E5),g.pl(P)}})},
Sqs=function(V){var t=(V.J.transferRetryCount||0)<3;
t&&(V=V.J,V.transferRetryCount=(V.transferRetryCount||0)+1);return t},GpY=function(V,t){t=t===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":t;
var x,u,Z,P;return g.Q(function(K){if(K.J==1)return V.J||HC(V,"setTransferToFailed: "+t),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t==="TRANSFER_FAILURE_REASON_NETWORK"?x="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":t==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.m(K,UK(V,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",t),2);if(K.J!=3)return Kc(V.wk,{entityKey:(u=V.J)==null?void 0:u.key,failureReason:x}),
Z=V.J?g.Oi(V.J.key).entityId:"",g.m(K,ll(V,Z),3);P=K.S;var R={videoId:Z,l9:V.J,offlineModeType:P},f=t,b={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};f&&(b.transferFailureReason=f,b.failureReason=OIn(f));fc(b,R);g.pl(K)})},UK=function(V,t,x,u){var Z;
return g.Q(function(P){if(P.J==1){if(!V.J)return HC(V,"saveTransferState: "+t),P.return();V.J.transferState=t;V.J.failureReason=u;g.AT(P,2);return g.m(P,kpt(V,function(K){return x?lO(K,"offlineVideoStreams",V.J.offlineVideoStreams).then(function(R){for(var f=g.G(R),b=f.next();!b.done;b=f.next())if((b=b.value)&&b.streamsProgress){b=g.G(b.streamsProgress);for(var E=b.next();!E.done;E=b.next())E.value.streamState=x}return SIU(K,R.filter(function(k){return!!k}),"offlineVideoStreams")}):g.Ye.resolve(void 0)}),
4)}if(P.J!=2)return g.GK(P,0);
Z=g.I9(P);return Z instanceof g.FM&&Z.type==="QUOTA_EXCEEDED"?g.m(P,V.ys("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):P.FX(0)})},kpt=function(V,t){var x;
return g.Q(function(u){if(!V.J)return u.return();x=V.J;return g.m(u,CT(V.S,{mode:"readwrite",LI:!0},function(Z){var P=[U_(Z,x,"transfer")];t&&P.push(t(Z));return g.Ye.all(P)}),0)})},yH=function(V){V.J=void 0;
V.G=void 0;V.W.stop()},OKr=function(V,t){var x,u,Z,P,K;
return g.Q(function(R){if(R.J==1)return x=g.Oi(t.key),u=x.entityId,Z=g.si(u,"playbackData"),g.m(R,hg(V.S,Z,"playbackData"),2);P=R.S;if((K=P)==null?0:K.playerResponseJson)return R.return(JSON.parse(P.playerResponseJson));throw Error("No PlayerResponse found");})},HC=function(V,t){V.api.J6("woffle",{mcte:t});
Zm("missing current transfer entity.")},ll=function(V,t){var x,u,Z;
return g.Q(function(P){if(P.J==1)return g.m(P,hg(V.S,g.si(t,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);x=P.S;return P.return((Z=(u=x)==null?void 0:u.offlineModeType)!=null?Z:void 0)})},sy7=function(V){return INE[V.transferState]!==void 0},N9c=function(V,t){var x=INE[V.transferState],u=INE[t.transferState];
return x!==u?x-u:Number(V.enqueuedTimestampMs)-Number(t.enqueuedTimestampMs)},Dm=function(V,t){var x=this;
this.Rj=V;this.api=t;this.B=new g.um;this.G=new g.v$;this.Wk={Bt:function(){return x.N.Wk.Bt()},
L0:function(){return x.B},
BZX:function(){return x.N},
g4:function(){return x.g4()},
aE:function(){return x.aE()},
j2:function(){return x.j2()},
oP:function(){return x.oP()},
D5:function(){return x.D5()},
nB:function(u){return x.nB(u)}};
this.N=new Rwt(function(){return vxz(x)},function(){x.j2()},this.api.Xl(),this.api.T.bind(this.api));
this.J=new PC(this.api);f5z(this.N)},vxz=function(V){return g.Q(function(t){V.api.Os("onOrchestrationBecameLeader");
return g.m(t,V.aE(),0)})},FKc=function(V){var t,x;
return g.Q(function(u){if(u.J==1)return g.m(u,VH(),2);if(u.J!=3){t=u.S;if(!t)return Zm("PES is undefined"),u.return();V.S=new qqU(t,V.api,V.N,V.J);x=V.Rh(t);return g.m(u,yRE(t,x,V.N,V.J,V.Rj),3)}V.L=u.S;return g.m(u,LKi(V),0)})},LKi=function(V){var t;
return g.Q(function(x){switch(x.J){case 1:if(!V.S)return Zm("transferManager is undefined"),x.return();if(V.S.J){x.FX(2);break}return g.m(x,j4(V.S),2);case 2:if(!V.Rj.T("woffle_enable_main_downloads_library")){x.FX(4);break}return g.m(x,V.rP(),4);case 4:if(!V.Rj.T("html5_offline_playback_position_sync")){x.FX(6);break}return g.m(x,V.Ow(),7);case 7:return g.m(x,V.nB(864E5),6);case 6:return g.m(x,V.refreshAllStaleEntities(43200,!0),9);case 9:return g.m(x,V.Uf(),10);case 10:if(!V.Rj.T("html5_retry_downloads_for_expiration")){x.FX(11);
break}return g.m(x,V.D5(),11);case 11:return V.C=g.Mc(function(){V.refreshAllStaleEntities(43200,!0);V.Uf()},9E5),g.q3(g.fq(),function(){return V.oP()}),g.m(x,VH(),13);
case 13:return t=x.S,g.m(x,qTE(t),14);case 14:$sc(V.N),g.pl(x)}})},Mgs=function(){var V,t,x,u,Z,P;
return g.Q(function(K){switch(K.J){case 1:return g.m(K,VH(),2);case 2:V=K.S;if(!V)return K.return([]);t=Date.now()/1E3;return g.m(K,w6(V,"offlineVideoPolicy"),3);case 3:x=K.S,u=g.G(x),Z=u.next();case 4:if(Z.done){K.FX(6);break}P=Z.value;if(!(P.expirationTimestamp&&Number(P.expirationTimestamp)<t)){K.FX(5);break}P.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";P.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.m(K,Jg(V,P,"offlineVideoPolicy"),5);
case 5:Z=u.next();K.FX(4);break;case 6:return K.return(x.map(function(R){return R.key}))}})},e4=function(V,t,x,u,Z){var P,K,R;
return g.Q(function(f){if(f.J==1)return g.m(f,VH(),2);P=f.S;if(!P)return f.return([]);K=t.map(function(b){var E=g.si(b,x);E={actionType:u,entityKey:E,actionMetadata:Object.assign({},ST7(),Z)};u!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(E.actionMetadata.priority=0);b=new pc(x,b,E);return S4(b)});
R=zRj(P,K);f5z(V.N);return f.return(R)})},gxr=function(V,t,x,u){var Z,P,K,R,f,b,E,k;
return g.Q(function(O){switch(O.J){case 1:Z=[],P=g.G(t),K=P.next();case 2:if(K.done){O.FX(4);break}R=K.value;if(R.upToDate||x&&!R.shouldAutoSyncMetadata||!R.playlistId){O.FX(3);break}f={};switch(u){case "mainPlaylistEntity":b={nextAutoRefreshIntervalSeconds:R.checkInSeconds,autoSync:x};f={mainPlaylistEntityActionMetadata:b};break;case "musicPlaylist":E={autoSync:x},f={musicPlaylistEntityActionMetadata:E}}return g.m(O,e4(V,[R.playlistId],u,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f),6);case 6:(k=
O.S)&&Z.push.apply(Z,g.v(k));case 3:K=P.next();O.FX(2);break;case 4:return O.return(Z)}})},X27=function(V,t){var x;
return g.Q(function(u){return t.length?(x=ST7(),g.dx(x,rc,{isEnqueuedForExpiredStreamUrlRefetch:!0}),V.api.J6("qrd",{v:t.length}),u.return(e4(V,t,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x))):u.return([])})},zz_=function(V,t,x){this.J=V;
this.Rj=t;this.N=x},Yqn=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z;
return g.Q(function(Y){switch(Y.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,P=[],g.AT(Y,2),g.m(Y,B9Y(V,Z),4);case 4:P=Y.S;if(!(V.Rj.T("woffle_enable_main_downloads_library")&&((K=P)==null?0:K.length))){Y.FX(5);break}return g.m(Y,Qos(V.J,[t.entityKey]),5);case 5:g.GK(Y,3);break;case 2:return R=g.I9(Y),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.FM&&R.type==="QUOTA_EXCEEDED"?(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Zm("Playlist add error"),Y.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,f,b));case 3:E=[];if(!V.Rj.T("html5_offline_prevent_redownload_downloaded_video")){Y.FX(7);break}return g.m(Y,p1t(V.J,"mainVideoEntity",P),8);case 8:P=Y.S;case 7:if((k=P)==null?0:k.length)for(O=g.G(P),N=O.next();!N.done;N=O.next())if(p=N.value,I=p.offlineVideoData,L=void 0,(L=I)==null?0:L.videoId)M=void 0,z=Number(((M=t.actionMetadata)==null?void 0:M.priority)||
0)+1,E.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",I.videoId,"mainVideoEntity",z,dc,mai(t,I,Z)));return Y.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,E))}})},aNU=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt,F,X,B,a,W,tT,Pw,Kl,T,bL,s4,fl,mh,E$,yn,io,Hw,nR,bF,QW,UY,kE,yo,ce,jz,Gw,iG,Yv,iN,Qm,WY,ox,M5,wl,lc,Pe,FO,ea;
return g.Q(function(OA){switch(OA.J){case 1:return x=$3(t),u=t.entityKey,Z=g.Oi(u).entityId,P=[],K=!1,Z==="!*$_ALL_ENTITIES_!*$"?(K=!0,g.m(OA,w6(V.J,"mainPlaylistEntity"),5)):g.m(OA,hg(V.J,u,"mainPlaylistEntity"),4);case 4:(R=OA.S)&&P.push(R);OA.FX(3);break;case 5:P=OA.S;case 3:if((f=P)==null||!f.length)return OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));b=g.l(t.actionMetadata,Qyi);k=(E=b)==null?void 0:E.nextAutoRefreshIntervalSeconds;N=(O=b)==null?void 0:O.autoSync;p=[];L=I=
!0;M=!1;if(!K&&N===!1){OA.FX(6);break}g.AT(OA,7);return g.m(OA,ewr(0,!!N,!0,P),9);case 9:p=OA.S;g.GK(OA,8);break;case 7:z=g.I9(OA);if(!(z instanceof Error&&z.message==="No data")){z instanceof Error&&z.message==="Empty response body"&&Zm(z.message);OA.FX(8);break}return Z==="!*$_ALL_ENTITIES_!*$"?g.m(OA,ggE(V.J,t,V.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.m(OA,FgY(Z,V.J,t,V.N),8);case 8:if(!p.length||!K&&p[0].playlistId!==Z)return OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));case 6:if(K){Y=[];r=g.G(p);for(n=r.next();!n.done;n=r.next())U=n.value,U.upToDate||N&&!U.shouldAutoSyncMetadata||!U.playlistId||(d={nextAutoRefreshIntervalSeconds:U.checkInSeconds,autoSync:N},Y.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U.playlistId,"mainPlaylistEntity",0,dc,{mainPlaylistEntityActionMetadata:d})));return OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,Y))}p.length&&(uL=p[0],M=!!uL.upToDate,N&&(I=(q1=uL.shouldAutoSyncMetadata)!=null?q1:!0,L=(w=uL.shouldAutoSyncVideos)!=
null?w:!0,uL.checkInSeconds&&(k=uL.checkInSeconds)));if(M||!I)return OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));H=[];C=P[0];if(!C.downloadState){S=void 0;OA.FX(15);break}return g.m(OA,hg(V.J,C.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:S=OA.S;case 15:return D=S,Ic=((ws=D)==null?0:ws.addedTimestampMillis)?String(D.addedTimestampMillis):void 0,g.AT(OA,17),g.m(OA,B9Y(V,Z,Ic,k),19);case 19:H=OA.S;g.GK(OA,18);break;case 17:t_=g.I9(OA);if(!(t_ instanceof Error&&
t_.message==="No data for playlist")){if(t_ instanceof Error&&t_.message==="Empty response body for playlist")Zm(t_.message);else return gs="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Cl="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t_ instanceof g.FM&&t_.type==="QUOTA_EXCEEDED"&&(gs="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Cl="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,gs,Cl));OA.FX(18);
break}return g.m(OA,FgY(Z,V.J,t,V.N),18);case 18:if(!L)return OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));uz=[];Nt=new Map;if((F=H)==null?0:F.length)for(X=g.G(H),B=X.next();!B.done;B=X.next())a=B.value,W=a.offlineVideoData,tT=void 0,((tT=W)==null?0:tT.videoId)&&Nt.set(W.videoId,W);Pw=new Map;Kl=[];if((T=C)==null?0:(bL=T.videos)==null?0:bL.length)for(s4=g.G(C.videos),fl=s4.next();!fl.done;fl=s4.next())if(mh=fl.value,E$=JSON.parse(g.Oi(mh).entityId),yn=E$.videoId)Nt.has(yn)?(Pw.set(yn,
Nt.get(yn)),Nt.delete(yn)):Kl.push(yn);Hw=Number(((io=t.actionMetadata)==null?void 0:io.priority)||0)+1;nR=g.G(Nt.entries());for(bF=nR.next();!bF.done;bF=nR.next())QW=bF.value,UY=g.G(QW),kE=UY.next().value,yo=UY.next().value,ce=kE,jz=yo,uz.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ce,"mainVideoEntity",Hw,dc,mai(t,jz,Z)));Gw=g.G(Pw.entries());for(iG=Gw.next();!iG.done;iG=Gw.next())Yv=iG.value,iN=g.G(Yv),Qm=iN.next().value,WY=iN.next().value,ox=Qm,M5=WY,uz.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
ox,"mainVideoEntity",Hw,dc,mai(t,M5,Z)));wl=g.G(Kl);for(lc=wl.next();!lc.done;lc=wl.next())Pe=lc.value,FO={playlistId:Z},ea={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:FO},uz.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Pe,"mainVideoEntity",0,dc,ea));return OA.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,uz))}})},rJY=function(V,t){var x,u,Z,P;
return g.Q(function(K){switch(K.J){case 1:return x=$3(t),g.AT(K,2),u=g.Oi(t.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.m(K,ggE(V.J,t,V.N,(Z=t.actionMetadata)==null?void 0:(P=Z.offlineLoggingData)==null?void 0:P.offlineDeleteReason),5):g.m(K,FgY(u,V.J,t,V.N),6);case 6:if(!V.Rj.T("woffle_enable_main_downloads_library")){K.FX(5);break}return g.m(K,a57(V.J,t.entityKey),5);case 5:g.GK(K,3);break;case 2:return g.I9(K),K.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},B9Y=function(V,t,x,u){var Z,P,K,R,f,b,E;
return g.Q(function(k){switch(k.J){case 1:return g.m(k,UsE([t]),2);case 2:return Z=k.S,g.m(k,T9$(V,Z[0],x,u),3);case 3:return P=k.S,K=P.mainPlaylistEntity,R=P.TbP,b=vg$(K,(f=R)==null?void 0:f.avatar),g.AT(k,4),g.m(k,IU(b),6);case 6:g.GK(k,5);break;case 4:E=g.I9(k),E instanceof Error&&E.message==="Failed to fetch"&&Zm(E.message);case 5:return k.return(Z[0].videos)}})},T9$=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r;
return g.Q(function(n){switch(n.J){case 1:Z=Date.now().toString();x||(x=Z);P=t.videos;K=t.playlistId;R=[];f=[];if(P)for(b=g.G(P),E=b.next();!E.done;E=b.next()){k=E.value;O=k.offlineVideoData;if(!O||!O.videoId)throw Zm("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");N=O.videoId;p={videoId:N,playlistId:K};I={id:g.si(JSON.stringify(p),"mainPlaylistVideoEntity"),video:g.si(N,"mainVideoEntity")};R.push(I);f.push(I.id)}M={key:g.si(K,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:x,lastSyncedTimestampMillis:Z};z={key:g.si(K,"mainPlaylistEntity"),playlistId:K,videos:f,title:t.title,thumbnailStyleData:WK$(t),visibility:oxF(t),downloadState:M.key};t.channel&&(Y=t.channel.offlineChannelData,L=nxt(g.si(K,"ytMainChannelEntity"),Y),z.channelOwner=L.id);((r=z)==null?0:r.entityMetadata)?(z.entityMetadata.offlineLastModifiedTimestampSeconds=t.lastModifiedTimestamp,u&&(z.entityMetadata.nextAutoRefreshIntervalSeconds=String(u))):z&&(z.entityMetadata={nextAutoRefreshIntervalSeconds:u?
String(u):void 0,offlineLastModifiedTimestampSeconds:t.lastModifiedTimestamp});g.AT(n,2);return g.m(n,CT(V.J,{mode:"readwrite",LI:!0},function(U){var d=U_(U,z,"mainPlaylistEntity"),uL=U_(U,M,"mainPlaylistDownloadStateEntity");d=[d,uL];uL=g.G(R);for(var q1=uL.next();!q1.done;q1=uL.next())d.push(U_(U,q1.value,"mainPlaylistVideoEntity"));L&&d.push(U_(U,L,"ytMainChannelEntity"));return g.Ye.all(d)}),4);
case 4:g.GK(n,3);break;case 2:throw g.I9(n),Zm("PES failure for playlist"),Error("PES failure for playlist");case 3:return n.return({mainPlaylistEntity:z,TbP:L,swP:R})}})},nxt=function(V,t){return{id:V,
channelId:t.channelId,title:t.title,avatar:t.thumbnail}},WK$=function(V){var t=[],x=V.videos;
x&&x.length>0&&t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:x[0].offlineVideoData.thumbnail}}});if((V=V.additionalMetadadatas)&&V.length>0)for(V=g.G(V),x=V.next();!x.done;x=V.next()){var u=x.value.offlineBundleItemPlaylistData,Z=void 0;x=(Z=u)==null?void 0:Z.style;Z=void 0;u={collageThumbnail:{coverThumbnail:(Z=u)==null?void 0:Z.coverThumbnail}};switch(x){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:u});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:u});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:u})}}return t},oxF=function(V){switch(V.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},mai=function(V,t,x){t={offlineVideoData:t,
playlistId:x};if(V=g.l(V.actionMetadata,Qyi))t.maximumDownloadQuality=V.maximumDownloadQuality;return{mainVideoEntityActionMetadata:t}},cJU=function(V,t,x){this.J=V;
this.Rj=t;this.N=x},lNz=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p;
return g.Q(function(I){switch(I.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,P=g.l(t.actionMetadata,Cc),R=!((K=P)==null?0:K.playlistId),g.AT(I,2),g.m(I,yJE(V,Z,void 0,(f=P)==null?void 0:f.offlineVideoData,R),4);case 4:g.GK(I,3);break;case 2:return b=g.I9(I),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.FM&&b.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
I.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,E,k));case 3:O=1;O=Number(((N=t.actionMetadata)==null?void 0:N.priority)||0)+1;var L=(L=g.l(t.actionMetadata,Cc))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;p=QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z,"playbackData",O,jyY,L);return I.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,[p]))}})},HK_=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z;
return g.Q(function(Y){switch(Y.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,g.m(Y,hg(V.J,t.entityKey,"mainVideoEntity"),2);case 2:P=Y.S;if(!P){K=void 0;Y.FX(3);break}return g.m(Y,hg(V.J,P.downloadState,"mainVideoDownloadStateEntity"),4);case 4:K=Y.S;case 3:R=K;if(!P||!R)return Y.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.AT(Y,5);return g.m(Y,yJE(V,Z,R.addedTimestampMillis,(b=g.l(t.actionMetadata,Cc))==null?void 0:b.offlineVideoData),7);case 7:E=1;E=Number(((k=
t.actionMetadata)==null?void 0:k.priority)||0)+1;f=QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z,"playbackData",E,jyY);g.GK(Y,6);break;case 5:O=g.I9(Y);if(!(O instanceof Error&&O.message==="No data")){if(O instanceof Error&&O.message==="Empty response body")Zm(O.message);else return N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.FM&&O.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,N,p));Y.FX(6);break}return g.m(Y,F7(V.J,Z),9);case 9:I=Y.S;L=g.l(t.actionMetadata,Cc);if(z=(M=L)==null?void 0:M.playlistId)I.playlistId=z;I.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.m(Y,vC(Z,V.J,t,V.N,I),6);case 6:return Y.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,f?[f]:void 0))}})},UaF=function(V,t){var x,u,Z,P,K,R,f,b,E,k;
return g.Q(function(O){switch(O.J){case 1:return x=$3(t),g.AT(O,2),u=g.Oi(t.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.m(O,ggE(V.J,t,V.N,(E=t.actionMetadata)==null?void 0:(k=E.offlineLoggingData)==null?void 0:k.offlineDeleteReason),5):g.m(O,F7(V.J,u),6);case 6:Z=O.S;P=g.l(t.actionMetadata,Cc);if(R=(K=P)==null?void 0:K.playlistId)Z.playlistId=R;Z.offlineDeleteReason=(f=t.actionMetadata)==null?void 0:(b=f.offlineLoggingData)==null?void 0:b.offlineDeleteReason;return g.m(O,vC(u,V.J,t,V.N,Z),7);
case 7:if(!V.Rj.T("woffle_enable_main_downloads_library")){O.FX(5);break}return g.m(O,a57(V.J,t.entityKey),5);case 5:g.GK(O,3);break;case 2:return g.I9(O),O.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},yJE=function(V,t,x,u,Z){var P,K,R,f,b,E;
return g.Q(function(k){switch(k.J){case 1:if(P=u){k.FX(2);break}return g.m(k,HIE([t]),3);case 3:K=k.S,P=K[0];case 2:return g.m(k,Da7(V,P,x,Z),4);case 4:R=k.S;f=R.mainVideoEntity;b=R.channelEntity;g.AT(k,5);var O=NG(f.thumbnail),N=NG(b.avatar);return g.m(k,IU(O.concat(N)),7);case 7:g.GK(k,0);break;case 5:E=g.I9(k),E instanceof Error&&E.message==="Failed to fetch"&&Zm(E.message),g.pl(k)}})},Da7=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O,N,p,I,L;
return g.Q(function(M){switch(M.J){case 1:x||(x=Date.now().toString());P=(Z=t.channel)==null?void 0:Z.offlineChannelData;K={id:g.si(t.videoId,"ytMainChannelEntity"),channelId:P.channelId,title:P.title,avatar:P.thumbnail};R={key:g.si(t.videoId,"mainVideoDownloadStateEntity"),playbackData:g.si(t.videoId,"playbackData"),addedTimestampMillis:x,videoDownloadContextEntity:g.si(t.videoId,"videoDownloadContextEntity")};f={key:g.si(t.videoId,"videoPlaybackPositionEntity"),videoId:t.videoId,lastPlaybackPositionSeconds:"0"};
V.Rj.T("html5_offline_playback_position_sync")&&(b={playbackPosition:f.key});E=g.si(t.videoId,"mainVideoEntity");k={key:E,videoId:t.videoId,title:t.title,thumbnail:t.thumbnail,localizedStrings:{viewCount:t.shortViewCountText},userState:b,lengthSeconds:t.lengthSeconds?Number(t.lengthSeconds):void 0,publishedTimestampMillis:t.publishedTimestamp?(Number(t.publishedTimestamp)*1E3).toString():void 0,formattedDescription:t.description,owner:K.id,downloadState:R.key};if(!V.Rj.T("woffle_enable_main_downloads_library")||
!u){M.FX(2);break}return g.m(M,YTi(V.J,[E]),3);case 3:if(p=M.S)O=p.mainDownloadsLibraryEntity,N=p.mainDownloadsListEntity;case 2:return L=NJ_,I={key:g.si(t.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.dx(R,L,I),g.m(M,CT(V.J,{mode:"readwrite",LI:!0},function(z){var Y=U_(z,K,"ytMainChannelEntity"),r=U_(z,R,"mainVideoDownloadStateEntity"),n=U_(z,k,"mainVideoEntity");Y=[Y,r,n];V.Rj.T("html5_offline_playback_position_sync")&&(r=U_(z,f,"videoPlaybackPositionEntity"),
Y.push(r));O&&(r=U_(z,O,"mainDownloadsLibraryEntity"),Y.push(r));N&&(r=U_(z,N,"mainDownloadsListEntity"),Y.push(r));I&&(z=U_(z,I,"downloadStatusEntity"),Y.push(z));return g.Ye.all(Y)}),4);
case 4:return M.return({mainVideoEntity:k,channelEntity:K})}})},ez$=function(V,t,x){this.J=V;
this.Rj=t;this.N=x},ChE=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C;
return g.Q(function(S){switch(S.J){case 1:return x=$3(t),u=[],g.m(S,nT.getInstance(),2);case 2:Z=S.S;if(!Z){S.FX(3);break}return g.m(S,Z.get("sdois"),4);case 4:return P=S.S,g.m(S,(R=Z)==null?void 0:R.get("lmqf"),5);case 5:K=S.S;case 3:g.AT(S,6);if(P===void 0)throw Error("prefStorage or opt-in state is undefined");f=[];if(P){S.FX(8);break}return g.m(S,msU(V.J),9);case 9:f=S.S,f.reverse();case 8:if(!f.length){S.FX(10);break}b=g.G(f);E=b.next();case 11:if(E.done){S.FX(10);break}k=E.value;if(!k){S.FX(12);
break}O=g.Oi(k).entityId;return g.m(S,F7(V.J,O),14);case 14:return N=S.S,N.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.m(S,vC(O,V.J,{entityKey:k,actionType:t.actionType},V.N,N),12);case 12:E=b.next();S.FX(11);break;case 10:return g.m(S,Cbr(P,(p=K)!=null?p:"SD"),16);case 16:return I=S.S,g.m(S,X1t(I),17);case 17:L=BJr(I);if(!V.Rj.T("woffle_enable_main_downloads_library")){S.FX(18);break}if(P){S.FX(19);break}return g.m(S,a57(V.J,g.aA),19);case 19:return g.m(S,Qos(V.J,[g.aA]),18);
case 18:if((M=L)==null?0:M.length)for(z=g.G(L),Y=z.next();!Y.done;Y=z.next())if(n=r=Y.value,U=n.actionType,d=n.entityKey,uL=n.actionMetadata,U&&d&&uL&&!g.l(uL,dar)){U==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(uL.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(q1=g.l(r.actionMetadata,Cc))q1.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",r.actionMetadata=Object.assign({},r.actionMetadata,{mainVideoEntityActionMetadata:q1});u.push(r)}g.GK(S,7);break;
case 6:return w=g.I9(S),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.FM&&w.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,H,C));case 7:return S.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,u))}})},JJE=function(){Dm.apply(this,arguments);
this.X="mainVideoEntity"},hzn=function(V,t,x){t=t===void 0?43200:t;
x=x===void 0?!0:x;var u=u===void 0?!1:u;var Z,P,K;return g.Q(function(R){switch(R.J){case 1:if(!V.B.U8())return R.return([]);Z=[];g.AT(R,2);return g.m(R,ewr(t,x,u),4);case 4:Z=R.S;g.GK(R,3);break;case 2:P=g.I9(R),P instanceof Error&&P.message==="No data"||P instanceof Error&&P.message==="Empty response body"&&Zm(P.message);case 3:return K=gxr(V,Z,x,"mainPlaylistEntity"),R.return(K)}})},w2j=function(V,t,x,u){u=u===void 0?!1:u;
var Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z;return g.Q(function(Y){switch(Y.J){case 1:return Z=[],g.m(Y,dsn(),2);case 2:return(P=Y.S)||u?g.m(Y,JoE(t,x),3):Y.return([]);case 3:K=Y.S;if((R=K)==null||!R.length)return Y.return([]);f={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};b=g.G(K);E=b.next();case 4:if(E.done){Y.FX(6);break}O=k=E.value;N=O.actionType;p=O.entityKey;I=O.actionMetadata;if(!(N&&p&&I)||g.l(I,dar)){Y.FX(5);break}N==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(I.offlineLoggingData=
f);L=g.Oi(p);M=L.entityId;return g.m(Y,e4(V,[M],"mainVideoEntity",N,I),8);case 8:z=Y.S,Z=Z.concat(z);case 5:E=b.next();Y.FX(4);break;case 6:return Y.return(Z)}})},V0i=function(V,t){this.J=V;
this.N=t},xKE=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M;
return g.Q(function(z){switch(z.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,P=[],g.AT(z,2),g.m(z,t0E(V,Z),4);case 4:P=z.S;if((K=P)==null||!K.length){z.FX(5);break}return g.m(z,ngF(V.J,t.entityKey),5);case 5:g.GK(z,3);break;case 2:return R=g.I9(z),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.FM&&R.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,f,b));case 3:return E=[],g.m(z,p1t(V.J,"musicTrack",P),7);case 7:P=z.S;if(P.length)for(k=g.G(P),O=k.next();!O.done;O=k.next())if(N=O.value,p=N.offlineVideoData,I=void 0,(I=p)==null?0:I.videoId)L=void 0,M=Number(((L=t.actionMetadata)==null?void 0:L.priority)||0)+1,E.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p.videoId,"musicTrack",M,JG,zA(t,p,Z)));return z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,E))}})},
uai=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt,F,X,B,a,W,tT,Pw,Kl,T,bL,s4,fl,mh,E$,yn,io,Hw,nR,bF,QW,UY,kE,yo;
return g.Q(function(ce){switch(ce.J){case 1:return x=$3(t),u=t.entityKey,Z=g.Oi(u).entityId,P=[],K=!1,Z==="!*$_ALL_ENTITIES_!*$"?(K=!0,g.m(ce,w6(V.J,"musicAlbumRelease"),5)):g.m(ce,hg(V.J,u,"musicAlbumRelease"),4);case 4:(R=ce.S)&&P.push(R);ce.FX(3);break;case 5:P=ce.S;case 3:if((f=P)==null||!f.length)return ce.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));if(K){b=[];E=g.G(P);for(k=E.next();!k.done;k=E.next())O=k.value,N=g.Oi(O.id).entityId,b.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
N,"musicAlbumRelease",0,JG));return ce.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,b))}p=[];I=P[0];L=void 0;if(!I.downloadMetadata){ce.FX(6);break}return g.m(ce,hg(V.J,I.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:M=ce.S,L=Number((Y=(z=M)==null?void 0:z.addedTimestampMillis)!=null?Y:"0")/1E3;case 6:return g.AT(ce,8),g.m(ce,t0E(V,Z,(r=L)==null?void 0:r.toString()),10);case 10:p=ce.S;g.GK(ce,9);break;case 8:n=g.I9(ce);if(!(n instanceof Error&&n.message===
"No data")){if(n instanceof Error&&n.message==="Empty response body")Zm(n.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.FM&&n.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ce.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,U,d));ce.FX(9);break}return g.m(ce,gc(Z,"musicAlbumRelease",V.J,
t,V.N),9);case 9:uL=[];q1=new Map;if((w=p)==null?0:w.length)for(H=g.G(p),C=H.next();!C.done;C=H.next())S=C.value,D=S.offlineVideoData,ws=void 0,((ws=D)==null?0:ws.videoId)&&q1.set(D.videoId,D);Ic=new Map;t_=[];if((gs=I)==null?0:(Cl=gs.tracks)==null?0:Cl.length)for(uz=g.G(I.tracks),Nt=uz.next();!Nt.done;Nt=uz.next())if(F=Nt.value,X=g.Oi(F).entityId)q1.has(X)?(Ic.set(X,q1.get(X)),q1.delete(X)):t_.push(X);a=Number(((B=t.actionMetadata)==null?void 0:B.priority)||0)+1;W=g.G(q1.entries());for(tT=W.next();!tT.done;tT=
W.next())Pw=tT.value,Kl=g.G(Pw),T=Kl.next().value,bL=Kl.next().value,s4=T,fl=bL,uL.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",s4,"musicTrack",a,JG,zA(t,fl)));mh=g.G(Ic.entries());for(E$=mh.next();!E$.done;E$=mh.next())yn=E$.value,io=g.G(yn),Hw=io.next().value,nR=io.next().value,bF=Hw,QW=nR,uL.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",bF,"musicTrack",a,JG,zA(t,QW)));UY=g.G(t_);for(kE=UY.next();!kE.done;kE=UY.next())yo=kE.value,uL.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",yo,
"musicTrack",0,JG));return ce.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,uL))}})},ZbF=function(V,t){var x,u;
return g.Q(function(Z){switch(Z.J){case 1:return x=$3(t),g.AT(Z,2),u=g.Oi(t.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.m(Z,X7(V.J,t,V.N),5):g.m(Z,gc(u,"musicAlbumRelease",V.J,t,V.N),6);case 6:return g.m(Z,coU(V.J,t.entityKey),5);case 5:g.GK(Z,3);break;case 2:return g.I9(Z),Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},t0E=function(V,t,x){var u,Z,P;
return g.Q(function(K){switch(K.J){case 1:return g.m(K,UsE([t]),2);case 2:return u=K.S,g.m(K,P6E(V,u[0],x),3);case 3:return Z=K.S,P=NG(Z.thumbnailDetails),g.m(K,IU(P),4);case 4:return K.return(u[0].videos)}})},P6E=function(V,t,x){var u,Z,P,K,R,f,b,E,k,O,N,p,I,L;
return g.Q(function(M){if(M.J==1){u=t.additionalMetadadatas;Z=void 0;if(u&&u.length>0)for(P=g.G(u),K=P.next();!K.done;K=P.next())if(R=K.value,R.offlineMusicPlaylistData){Z=R.offlineMusicPlaylistData;break}f=t.playlistId;b=yor(t);E=b.xO;k=b.dY;O=x?(Number(x)*1E3).toString():Date.now().toString();N=t.lastModifiedTimestamp?(Number(t.lastModifiedTimestamp)*1E3).toString():"0";p={id:g.si(f,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:k,lastModifiedTimestampMillis:N,addedTimestampMillis:O,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};I={id:g.si(f,"musicAlbumRelease"),title:t.title,audioPlaylistId:f,trackCount:t.totalVideoCount,tracks:E,downloadMetadata:p.id};Z&&(I.thumbnailDetails=(L=Z.albumHqThumbnail)!=null?L:Z.albumArtistThumbnail,I.artistDisplayName=Z.albumArtistDisplayName,I.releaseDate=Z.albumReleaseDate,I.contentRating={explicitType:Z.albumReleaseExplicitType},I.releaseType=Z.albumReleaseType);return g.m(M,CT(V.J,{mode:"readwrite",LI:!0},function(z){var Y=U_(z,I,"musicAlbumRelease");
z=U_(z,p,"musicAlbumReleaseDownloadMetadataEntity");return g.Ye.all([Y,z])}),2)}return M.return(I)})},KmE=function(V,t){this.J=V;
this.N=t},RJc=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M;
return g.Q(function(z){switch(z.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,P=[],g.AT(z,2),g.m(z,qUz(V,Z),4);case 4:P=z.S;if((K=P)==null||!K.length){z.FX(5);break}return g.m(z,ngF(V.J,t.entityKey),5);case 5:g.GK(z,3);break;case 2:return R=g.I9(z),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.FM&&R.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,f,b));case 3:return E=[],g.m(z,p1t(V.J,"musicTrack",P),7);case 7:P=z.S;if(P.length)for(k=g.G(P),O=k.next();!O.done;O=k.next())if(N=O.value,p=N.offlineVideoData,I=void 0,(I=p)==null?0:I.videoId)L=void 0,M=Number(((L=t.actionMetadata)==null?void 0:L.priority)||0)+1,E.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p.videoId,"musicTrack",M,hG,zA(t,p,Z)));return z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,E))}})},
frc=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt,F,X,B,a,W,tT,Pw,Kl,T,bL,s4,fl,mh,E$,yn,io,Hw,nR,bF,QW,UY,kE,yo,ce,jz,Gw,iG,Yv,iN,Qm,WY,ox,M5,wl,lc;
return g.Q(function(Pe){switch(Pe.J){case 1:return x=$3(t),u=t.entityKey,Z=g.Oi(u).entityId,P=[],K=!1,Z==="!*$_ALL_ENTITIES_!*$"?(K=!0,g.m(Pe,w6(V.J,"musicPlaylist"),5)):g.m(Pe,hg(V.J,u,"musicPlaylist"),4);case 4:(R=Pe.S)&&P.push(R);Pe.FX(3);break;case 5:P=Pe.S;case 3:if((f=P)==null||!f.length)return Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));b=g.l(t.actionMetadata,jo_);k=(E=b)==null?void 0:E.autoSync;O=[];p=N=!0;I=!1;L=void 0;if(!K&&k===!1){Pe.FX(6);break}g.AT(Pe,7);return g.m(Pe,
hw$(0,!!k,!0,P),9);case 9:O=Pe.S;g.GK(Pe,8);break;case 7:M=g.I9(Pe);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&Zm(M.message);Pe.FX(8);break}return Z==="!*$_ALL_ENTITIES_!*$"?g.m(Pe,X7(V.J,t,V.N),8):g.m(Pe,gc(Z,"musicPlaylist",V.J,t,V.N),8);case 8:if(!O.length||!K&&O[0].playlistId!==Z)return Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));case 6:if(K){z=[];Y=g.G(O);for(r=Y.next();!r.done;r=Y.next())n=r.value,n.upToDate||
k&&!n.shouldAutoSyncMetadata||!n.playlistId||(U={autoSync:k},z.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n.playlistId,"musicPlaylist",0,hG,{musicPlaylistEntityActionMetadata:U})));return Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,z))}O.length&&(d=O[0],I=!!d.upToDate,k&&(N=(uL=d.shouldAutoSyncMetadata)!=null?uL:!0,p=(q1=d.shouldAutoSyncVideos)!=null?q1:!0,d.checkInSeconds&&(L=d.checkInSeconds)));if(I||!N)return Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));w=[];H=P[0];C=void 0;if(!H.downloadMetadata){Pe.FX(15);break}return g.m(Pe,hg(V.J,H.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:S=Pe.S,C=Number((ws=(D=S)==null?void 0:D.addedTimestampMillis)!=null?ws:"0")/1E3;case 15:return g.AT(Pe,17),g.m(Pe,qUz(V,Z,(Ic=C)==null?void 0:Ic.toString(),L),19);case 19:w=Pe.S;g.GK(Pe,18);break;case 17:t_=g.I9(Pe);if(!(t_ instanceof Error&&t_.message==="No data")){if(t_ instanceof Error&&t_.message==="Empty response body")Zm(t_.message);else return gs=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Cl="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t_ instanceof g.FM&&t_.type==="QUOTA_EXCEEDED"&&(gs="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Cl="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,gs,Cl));Pe.FX(18);break}return g.m(Pe,gc(Z,"musicPlaylist",V.J,t,V.N),18);case 18:if(!p)return Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));uz=[];Nt=new Map;if((F=w)==null?0:F.length)for(X=g.G(w),B=X.next();!B.done;B=X.next())a=B.value,W=a.offlineVideoData,tT=void 0,((tT=W)==null?0:tT.videoId)&&Nt.set(W.videoId,W);Pw=new Map;Kl=[];if((T=H)==null?0:(bL=T.tracks)==null?0:bL.length)for(s4=g.G(H.tracks),fl=s4.next();!fl.done;fl=s4.next())if(mh=fl.value,E$=g.Oi(mh).entityId)Nt.has(E$)?(Pw.set(E$,Nt.get(E$)),Nt.delete(E$)):Kl.push(E$);io=Number(((yn=t.actionMetadata)==null?void 0:yn.priority)||0)+1;Hw=g.G(Nt.entries());for(nR=Hw.next();!nR.done;nR=
Hw.next())bF=nR.value,QW=g.G(bF),UY=QW.next().value,kE=QW.next().value,yo=UY,ce=kE,uz.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",yo,"musicTrack",io,hG,zA(t,ce)));jz=g.G(Pw.entries());for(Gw=jz.next();!Gw.done;Gw=jz.next())iG=Gw.value,Yv=g.G(iG),iN=Yv.next().value,Qm=Yv.next().value,WY=iN,ox=Qm,uz.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",WY,"musicTrack",io,hG,zA(t,ox)));M5=g.G(Kl);for(wl=M5.next();!wl.done;wl=M5.next())lc=wl.value,uz.push(QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
lc,"musicTrack",0,hG));return Pe.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,uz))}})},$Kj=function(V,t){var x,u;
return g.Q(function(Z){switch(Z.J){case 1:return x=$3(t),g.AT(Z,2),u=g.Oi(t.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.m(Z,X7(V.J,t,V.N),5):g.m(Z,gc(u,"musicPlaylist",V.J,t,V.N),6);case 6:return g.m(Z,coU(V.J,t.entityKey),5);case 5:g.GK(Z,3);break;case 2:return g.I9(Z),Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},qUz=function(V,t,x,u){var Z,P,K;
return g.Q(function(R){switch(R.J){case 1:return g.m(R,UsE([t]),2);case 2:return Z=R.S,g.m(R,bbU(V,Z[0],x,u),3);case 3:return P=R.S,K=NG(P.thumbnailDetails),g.m(R,IU(K),4);case 4:return R.return(Z[0].videos)}})},bbU=function(V,t,x,u){var Z,P,K,R,f,b,E,k,O;
return g.Q(function(N){return N.J==1?(Z=t.playlistId,P=yor(t),K=P.xO,R=P.dY,f=x?(Number(x)*1E3).toString():Date.now().toString(),b=t.lastModifiedTimestamp?(Number(t.lastModifiedTimestamp)*1E3).toString():"0",E={id:g.si(Z,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:R,lastModifiedTimestampMillis:b,addedTimestampMillis:f,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},k={id:g.si(Z,"musicPlaylist"),title:t.title,playlistId:Z,thumbnailDetails:t.thumbnail,visibility:Eyj(t),trackCount:t.totalVideoCount,
tracks:K,downloadMetadata:E.id},u&&(((O=k)==null?0:O.entityMetadata)?k.entityMetadata.nextAutoRefreshIntervalSeconds=String(u):k&&(k.entityMetadata={nextAutoRefreshIntervalSeconds:String(u)})),g.m(N,CT(V.J,{mode:"readwrite",LI:!0},function(p){var I=U_(p,k,"musicPlaylist");p=U_(p,E,"musicPlaylistDownloadMetadataEntity");return g.Ye.all([I,p])}),2)):N.return(k)})},Eyj=function(V){switch(V.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},k6$=function(V,t){this.J=V;
this.N=t},NyE=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p;
return g.Q(function(I){switch(I.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,P=g.l(t.actionMetadata,ibi),g.AT(I,2),g.m(I,ObE(V,Z,void 0,(K=P)==null?void 0:K.track,(R=P)==null?void 0:R.albumRelease),4);case 4:if((f=P)==null?0:f.playlistId){I.FX(5);break}return g.m(I,ngF(V.J,t.entityKey),5);case 5:g.GK(I,3);break;case 2:return b=g.I9(I),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.FM&&b.type==="QUOTA_EXCEEDED"&&
(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,E,k));case 3:N=Number(((O=t.actionMetadata)==null?void 0:O.priority)||0)+1;var L=(L=g.l(t.actionMetadata,ibi))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;p=QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z,"playbackData",N,sOs,L);return I.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x,[p]))}})},pkF=function(V,t){var x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L;
return g.Q(function(M){switch(M.J){case 1:return x=$3(t),u=g.Oi(t.entityKey),Z=u.entityId,g.m(M,hg(V.J,t.entityKey,"musicTrack"),2);case 2:P=M.S;if(!P){K=void 0;M.FX(3);break}return g.m(M,hg(V.J,P.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:K=M.S;case 3:R=K;if(!P||!R)return M.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));b=g.l(t.actionMetadata,ibi);g.AT(M,5);return g.m(M,ObE(V,Z,R.addedTimestampMillis,(E=b)==null?void 0:E.track,(k=b)==null?void 0:k.albumRelease),
7);case 7:N=Number(((O=t.actionMetadata)==null?void 0:O.priority)||0)+1;f=QH("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z,"playbackData",N,sOs);g.GK(M,6);break;case 5:p=g.I9(M);if(!(p instanceof Error&&p.message==="No data")){if(p instanceof Error&&p.message==="Empty response body")Zm(p.message);else return I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.FM&&p.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,I,L));M.FX(6);break}return g.m(M,MG(Z,V.J,t,V.N),6);case 6:return M.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,f?[f]:void 0))}})},Amr=function(V,t){var x,u;
return g.Q(function(Z){switch(Z.J){case 1:return x=$3(t),g.AT(Z,2),u=g.Oi(t.entityKey).entityId,u==="!*$_ALL_ENTITIES_!*$"?g.m(Z,X7(V.J,t,V.N),5):g.m(Z,MG(u,V.J,t,V.N),6);case 6:return g.m(Z,coU(V.J,t.entityKey),5);case 5:g.GK(Z,3);break;case 2:return g.I9(Z),Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new aU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},ObE=function(V,t,x,u,Z){var P,K,R,f,b,E;
return g.Q(function(k){switch(k.J){case 1:if(P=u){k.FX(2);break}return g.m(k,HIE([t]),3);case 3:K=k.S,R=K[0],P=ogj(R);case 2:return g.m(k,SUc(V,P,t,Z,x),4);case 4:f=k.S;b=f.musicTrackEntity;E=f.Wq;var O=NG(b.thumbnailDetails),N=[];E&&(N=NG(E.thumbnailDetails));return g.m(k,IU(O.concat(N)),0)}})},SUc=function(V,t,x,u,Z){var P;
return g.Q(function(K){return K.J==1?(Z||(Z=Date.now().toString()),P={id:g.si(x,"musicTrackDownloadMetadataEntity"),playbackData:g.si(x,"playbackData"),addedTimestampMillis:Z,videoDownloadContextEntity:g.si(x,"videoDownloadContextEntity")},u&&(t.albumRelease=u.id),g.m(K,CT(V.J,{mode:"readwrite",LI:!0},function(R){var f=[],b=U_(R,P,"musicTrackDownloadMetadataEntity");f.push(b);b=U_(R,t,"musicTrack");f.push(b);u&&(R=U_(R,u,"musicAlbumRelease"),f.push(R));return g.Ye.all(f)}),2)):K.J!=3?g.m(K,il(x,"musicTrackDownloadMetadataEntity",
V.J,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):K.return({musicTrackEntity:t,
Wq:u})})},wc=function(){Dm.apply(this,arguments);
this.X="musicTrack"},G6j=function(V,t,x){t=t===void 0?43200:t;
x=x===void 0?!0:x;var u=u===void 0?!1:u;var Z,P;return g.Q(function(K){switch(K.J){case 1:if(!V.B.U8())return K.return([]);Z=[];g.AT(K,2);return g.m(K,hw$(t,x,u),4);case 4:Z=K.S;g.GK(K,3);break;case 2:g.I9(K);case 3:return P=gxr(V,Z,x,"musicPlaylist"),K.return(P)}})},IrY=function(){g.m5.apply(this,arguments);
var V=this;this.events=new g.j6(this);this.Rj=this.player.K();this.Wk={Ggy:function(){return V.J},
er:function(){return V.er()},
GP:function(t){return V.GP(t)}}},vys=function(V){var t;
V=g.l((t=V.getWatchNextResponse())==null?void 0:t.currentVideoEndpoint,g.w8);if(V==null?0:V.playlistId)var x=V.playlistId;return x},Lms=function(V,t){var x,u,Z,P;
return g.Q(function(K){if(K.J==1){x=t.clientPlaybackNonce;u={cpn:x,offlineSourceVisualElement:g.mn(t.Us||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};t.S&&(u.videoFmt=Number(t.S.itag));t.W&&(u.audioFmt=Number(t.W.itag));if((Z=vys(t))&&t.videoId){var R=t.videoId;R=Z!=="PPSV"?Promise.resolve(!1):V.J.Df(R);K=g.m(K,R,3)}else K=K.FX(2);return K}K.J!=2&&(P=K.S)&&(u.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");V.S=x;g.pq("offlinePlaybackStarted",u);g.pl(K)})};
g.A(W9,TN);g.Zz.Object.defineProperties(W9.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.J.entityMetadata},
set:function(V){this.J.entityMetadata=V}}});
g.A(I7j,W9);I7j.prototype.S=function(){return[]};
g.A(vSr,W9);vSr.prototype.S=function(){return[]};
g.A(L0_,W9);L0_.prototype.S=function(){return[]};
g.A(F0s,W9);F0s.prototype.S=function(){return[]};
g.A(MNt,W9);MNt.prototype.S=function(){var V=[];this.J.alternateChannel&&V.push(this.J.alternateChannel);this.J.alternateChannelList&&V.push.apply(V,g.v(this.J.alternateChannelList));this.J.oneofChannelEntity&&V.push(this.J.oneofChannelEntity);return[].concat(g.v(new Set(V)))};
g.A(gS$,W9);gS$.prototype.S=function(){var V=[];this.J.entryCollection&&V.push(this.J.entryCollection);return[].concat(g.v(new Set(V)))};
g.A(X$j,TN);X$j.prototype.S=function(){var V=[];this.J.video&&V.push(this.J.video);return[].concat(g.v(new Set(V)))};
g.A(zUF,W9);zUF.prototype.S=function(){var V=[];this.J.parentPlaylist&&V.push(this.J.parentPlaylist);if(this.J.entries)for(var t=g.G(this.J.entries),x=t.next();!x.done;x=t.next())V.push.apply(V,g.v((new X$j(x.value)).S()));return[].concat(g.v(new Set(V)))};
g.A(Bz_,W9);Bz_.prototype.S=function(){var V=[];this.J.descriptionEntity&&V.push(this.J.descriptionEntity);this.J.creators&&V.push.apply(V,g.v(this.J.creators));this.J.theBiggestFan&&V.push(this.J.theBiggestFan);return[].concat(g.v(new Set(V)))};
g.A(m5n,W9);m5n.prototype.S=function(){return[]};
g.A(YBt,W9);YBt.prototype.S=function(){return[]};
g.A(QNc,W9);QNc.prototype.S=function(){return[]};
g.A(a7r,W9);a7r.prototype.S=function(){return[]};
g.A(rn$,W9);rn$.prototype.S=function(){return[]};
g.A(Tz7,W9);Tz7.prototype.S=function(){return[]};
g.A(W0E,W9);W0E.prototype.S=function(){return[]};
g.A(oSF,W9);oSF.prototype.S=function(){return[]};
g.A(nS7,W9);nS7.prototype.S=function(){return[]};
g.A(cnj,W9);cnj.prototype.S=function(){var V=[];this.J.downloadsList&&V.push(this.J.downloadsList);this.J.smartDownloadsList&&V.push(this.J.smartDownloadsList);this.J.recommendedDownloadsList&&V.push(this.J.recommendedDownloadsList);this.J.refresh&&V.push(this.J.refresh);return[].concat(g.v(new Set(V)))};
g.A(yn7,TN);yn7.prototype.S=function(){var V=[];this.J.video&&V.push(this.J.video);this.J.playlist&&V.push(this.J.playlist);this.J.videoItem&&V.push(this.J.videoItem);this.J.playlistItem&&V.push(this.J.playlistItem);return[].concat(g.v(new Set(V)))};
g.A(jNn,W9);jNn.prototype.S=function(){var V=[];this.J.refresh&&V.push(this.J.refresh);if(this.J.downloads)for(var t=g.G(this.J.downloads),x=t.next();!x.done;x=t.next())V.push.apply(V,g.v((new yn7(x.value)).S()));return[].concat(g.v(new Set(V)))};
g.A(l77,W9);l77.prototype.S=function(){var V=[];this.J.localImageEntities&&V.push.apply(V,g.v(this.J.localImageEntities));return[].concat(g.v(new Set(V)))};
g.A(H27,W9);H27.prototype.S=function(){var V=[];this.J.playbackData&&V.push(this.J.playbackData);this.J.localImageEntities&&V.push.apply(V,g.v(this.J.localImageEntities));this.J.videoDownloadContextEntity&&V.push(this.J.videoDownloadContextEntity);return[].concat(g.v(new Set(V)))};
g.A(U5U,W9);U5U.prototype.S=function(){return[]};
g.A(D5i,W9);D5i.prototype.S=function(){var V=[];this.J.fakeChildren&&V.push.apply(V,g.v(this.J.fakeChildren));return[].concat(g.v(new Set(V)))};
g.A(eUi,W9);eUi.prototype.S=function(){var V=[];this.J.video&&V.push(this.J.video);this.J.playbackData&&V.push(this.J.playbackData);this.J.offlineVideoPolicy&&V.push(this.J.offlineVideoPolicy);return[].concat(g.v(new Set(V)))};
g.A(d5$,W9);d5$.prototype.S=function(){return[]};
g.A(CqF,W9);CqF.prototype.S=function(){var V=[];this.J.channelOwner&&V.push(this.J.channelOwner);this.J.videos&&V.push.apply(V,g.v(this.J.videos));this.J.collaboratorChannels&&V.push.apply(V,g.v(this.J.collaboratorChannels));this.J.downloadState&&V.push(this.J.downloadState);this.J.refresh&&V.push(this.J.refresh);return[].concat(g.v(new Set(V)))};
g.A(JnE,W9);JnE.prototype.S=function(){var V=[];this.J.video&&V.push(this.J.video);this.J.channelContributor&&V.push(this.J.channelContributor);return[].concat(g.v(new Set(V)))};
g.A(hUt,TN);hUt.prototype.S=function(){var V=[];this.J.localImageEntities&&V.push.apply(V,g.v(this.J.localImageEntities));this.J.videoDownloadContextEntity&&V.push(this.J.videoDownloadContextEntity);return[].concat(g.v(new Set(V)))};
g.A(w$Y,TN);w$Y.prototype.S=function(){var V=[];this.J.recommendedVideoMetadata&&V.push.apply(V,g.v((new hUt(this.J.recommendedVideoMetadata)).S()));return[].concat(g.v(new Set(V)))};
g.A(V9_,TN);V9_.prototype.S=function(){var V=[];this.J.playbackPosition&&V.push(this.J.playbackPosition);return[].concat(g.v(new Set(V)))};
g.A(t9F,W9);t9F.prototype.S=function(){var V=[];this.J.owner&&V.push(this.J.owner);this.J.downloadState&&V.push(this.J.downloadState);this.J.userState&&V.push.apply(V,g.v((new V9_(this.J.userState)).S()));this.J.additionalMetadata&&V.push.apply(V,g.v((new w$Y(this.J.additionalMetadata)).S()));return[].concat(g.v(new Set(V)))};
g.A(xA_,W9);xA_.prototype.S=function(){var V=[];this.J.userChannelDetails&&V.push(this.J.userChannelDetails);return[].concat(g.v(new Set(V)))};
g.A(utj,W9);utj.prototype.S=function(){var V=[];this.J.channelOwner&&V.push(this.J.channelOwner);this.J.playbackPosition&&V.push(this.J.playbackPosition);this.J.localImageEntities&&V.push.apply(V,g.v(this.J.localImageEntities));this.J.downloadStatus&&V.push(this.J.downloadStatus);return[].concat(g.v(new Set(V)))};
g.A(Z_c,W9);Z_c.prototype.S=function(){return[]};
g.A(PWE,W9);PWE.prototype.S=function(){return[]};
g.A(KWi,W9);KWi.prototype.S=function(){return[]};
g.A(qwr,W9);qwr.prototype.S=function(){return[]};
g.A(Rii,W9);Rii.prototype.S=function(){return[]};
g.A(fdY,W9);fdY.prototype.S=function(){return[]};
g.A($Ar,W9);$Ar.prototype.S=function(){return[]};
g.A(b_c,W9);b_c.prototype.S=function(){return[]};
g.A(EwY,W9);EwY.prototype.S=function(){return[]};
g.A(kCz,W9);kCz.prototype.S=function(){return[]};
g.A(i_Y,W9);i_Y.prototype.S=function(){var V=[];this.J.trackDownloadMetadatas&&V.push.apply(V,g.v(this.J.trackDownloadMetadatas));return[].concat(g.v(new Set(V)))};
g.A(O_7,W9);
O_7.prototype.S=function(){var V=[];this.J.downloadedTracks&&V.push.apply(V,g.v(this.J.downloadedTracks));this.J.smartDownloadedTracks&&V.push.apply(V,g.v(this.J.smartDownloadedTracks));this.J.downloadedEpisodes&&V.push.apply(V,g.v(this.J.downloadedEpisodes));this.J.downloadedAlbumReleases&&V.push.apply(V,g.v(this.J.downloadedAlbumReleases));this.J.smartDownloadedAlbumReleases&&V.push.apply(V,g.v(this.J.smartDownloadedAlbumReleases));this.J.downloadedPlaylists&&V.push.apply(V,g.v(this.J.downloadedPlaylists));this.J.smartDownloadedPlaylists&&
V.push.apply(V,g.v(this.J.smartDownloadedPlaylists));this.J.metadataOnlyTracks&&V.push.apply(V,g.v(this.J.metadataOnlyTracks));return[].concat(g.v(new Set(V)))};
g.A(sx7,W9);sx7.prototype.S=function(){var V=[];this.J.trackDownloadMetadatas&&V.push.apply(V,g.v(this.J.trackDownloadMetadatas));return[].concat(g.v(new Set(V)))};
g.A(NKz,W9);NKz.prototype.S=function(){var V=[];this.J.playbackData&&V.push(this.J.playbackData);this.J.localImageEntities&&V.push.apply(V,g.v(this.J.localImageEntities));this.J.videoDownloadContextEntity&&V.push(this.J.videoDownloadContextEntity);return[].concat(g.v(new Set(V)))};
g.A(pYU,W9);pYU.prototype.S=function(){var V=[];this.J.musicLibraryStatusEntity&&V.push(this.J.musicLibraryStatusEntity);this.J.primaryArtists&&V.push.apply(V,g.v(this.J.primaryArtists));this.J.details&&V.push(this.J.details);this.J.userDetails&&V.push(this.J.userDetails);this.J.tracks&&V.push.apply(V,g.v(this.J.tracks));this.J.share&&V.push(this.J.share);this.J.downloadMetadata&&V.push(this.J.downloadMetadata);this.J.refresh&&V.push(this.J.refresh);return[].concat(g.v(new Set(V)))};
g.A(AOs,W9);AOs.prototype.S=function(){var V=[];this.J.albumRelease&&V.push(this.J.albumRelease);this.J.tracks&&V.push.apply(V,g.v(this.J.tracks));return[].concat(g.v(new Set(V)))};
g.A(SwF,W9);SwF.prototype.S=function(){var V=[];this.J.albumRelease&&V.push(this.J.albumRelease);return[].concat(g.v(new Set(V)))};
g.A(GCj,W9);GCj.prototype.S=function(){var V=[];this.J.details&&V.push(this.J.details);this.J.userDetails&&V.push(this.J.userDetails);return[].concat(g.v(new Set(V)))};
g.A(Idj,W9);Idj.prototype.S=function(){var V=[];this.J.parentArtist&&V.push(this.J.parentArtist);return[].concat(g.v(new Set(V)))};
g.A(vws,W9);vws.prototype.S=function(){var V=[];this.J.parentArtist&&V.push(this.J.parentArtist);return[].concat(g.v(new Set(V)))};
g.A(LWj,W9);LWj.prototype.S=function(){return[]};
g.A(FWU,W9);FWU.prototype.S=function(){return[]};
g.A(M9Y,TN);M9Y.prototype.S=function(){var V=[];this.J.creatorEntity&&V.push(this.J.creatorEntity);return[].concat(g.v(new Set(V)))};
g.A(gwi,W9);
gwi.prototype.S=function(){var V=[];this.J.tracks&&V.push.apply(V,g.v(this.J.tracks));this.J.refresh&&V.push(this.J.refresh);this.J.musicLibraryStatusEntity&&V.push(this.J.musicLibraryStatusEntity);this.J.details&&V.push(this.J.details);this.J.downloadMetadata&&V.push(this.J.downloadMetadata);this.J.sideloadMetadata&&V.push(this.J.sideloadMetadata);this.J.userDetails&&V.push(this.J.userDetails);this.J.entryCollection&&V.push(this.J.entryCollection);this.J.share&&V.push(this.J.share);this.J.podcastShowAdditionalMetadata&&V.push.apply(V,
g.v((new M9Y(this.J.podcastShowAdditionalMetadata)).S()));return[].concat(g.v(new Set(V)))};
g.A(XYF,W9);XYF.prototype.S=function(){return[]};
g.A(zic,W9);
zic.prototype.S=function(){var V=[];this.J.musicLibraryStatusEntity&&V.push(this.J.musicLibraryStatusEntity);this.J.artists&&V.push.apply(V,g.v(this.J.artists));this.J.audioModeVersion&&V.push(this.J.audioModeVersion);this.J.videoModeVersion&&V.push(this.J.videoModeVersion);this.J.userDetails&&V.push(this.J.userDetails);this.J.details&&V.push(this.J.details);this.J.albumRelease&&V.push(this.J.albumRelease);this.J.share&&V.push(this.J.share);this.J.libraryEdit&&V.push(this.J.libraryEdit);this.J.downloadMetadata&&
V.push(this.J.downloadMetadata);this.J.playbackPosition&&V.push(this.J.playbackPosition);this.J.lyrics&&V.push(this.J.lyrics);return[].concat(g.v(new Set(V)))};
g.A(BKc,W9);BKc.prototype.S=function(){var V=[];this.J.parentTrack&&V.push(this.J.parentTrack);return[].concat(g.v(new Set(V)))};
g.A(mAE,W9);mAE.prototype.S=function(){var V=[];this.J.parentTrack&&V.push(this.J.parentTrack);return[].concat(g.v(new Set(V)))};
g.A(Ywt,W9);Ywt.prototype.S=function(){return[]};
g.A(Qxs,W9);Qxs.prototype.S=function(){return[]};
g.A(adE,W9);adE.prototype.S=function(){return[]};
g.A(rOF,W9);rOF.prototype.S=function(){return[]};
g.A(TK$,W9);TK$.prototype.S=function(){var V=[];this.J.transfer&&V.push(this.J.transfer);this.J.adsPlaybackData&&V.push.apply(V,g.v(this.J.adsPlaybackData));this.J.drmLicense&&V.push(this.J.drmLicense);this.J.offlineVideoPolicy&&V.push(this.J.offlineVideoPolicy);this.J.videoDownloadContextEntity&&V.push(this.J.videoDownloadContextEntity);return[].concat(g.v(new Set(V)))};
g.A(WW7,W9);WW7.prototype.S=function(){return[]};
g.A(own,W9);own.prototype.S=function(){var V=[];this.J.offlineVideoStreams&&V.push.apply(V,g.v(this.J.offlineVideoStreams));this.J.captionTrack&&V.push.apply(V,g.v(this.J.captionTrack));return[].concat(g.v(new Set(V)))};
g.A(nw7,W9);nw7.prototype.S=function(){return[]};
g.A(cO$,W9);cO$.prototype.S=function(){return[]};
g.A(yOU,W9);yOU.prototype.S=function(){return[]};
g.A(jxE,W9);jxE.prototype.S=function(){return[]};
g.A(ldY,W9);ldY.prototype.S=function(){return[]};
g.A(H_i,W9);H_i.prototype.S=function(){return[]};
g.A(UAF,W9);UAF.prototype.S=function(){return[]};
g.A(DAE,W9);DAE.prototype.S=function(){return[]};
g.A(eir,W9);eir.prototype.S=function(){return[]};
g.A(dAF,W9);dAF.prototype.S=function(){return[]};
g.A(CW_,W9);CW_.prototype.S=function(){return[]};
g.A(JO$,W9);JO$.prototype.S=function(){return[]};
g.A(hi7,W9);hi7.prototype.S=function(){return[]};
g.A(wYU,W9);wYU.prototype.S=function(){return[]};
g.A(Vhi,W9);Vhi.prototype.S=function(){return[]};
g.A(ths,W9);ths.prototype.S=function(){return[]};
g.A(xq_,W9);xq_.prototype.S=function(){return[]};
var w1E=["browse","music/browse","unplugged/browse"],Z3_=["offline/playlist_sync_check"],l5i=["offline"],VUE=["offline/offline_video_playback_position_sync"],xrr=["offline/get_playback_data_entity"],oH;nT.getInstance=function(){return g.Q(function(V){return V.return(new Promise(function(t){g.qR().then(function(x){x?(nT.instance||(nT.instance=new nT(x)),t(nT.instance)):t(void 0)})}))})};
nT.prototype.get=function(V){var t=this,x,u,Z;return g.Q(function(P){if(P.J==1)return g.m(P,K97(t.token),2);if(P.J!=3)return x=P.S,g.m(P,x.get("prefs",V),3);u=P.S;if(!u)return P.return();Z=(0,g.Tu)();return u.expirationTimestampMs<=Z?P.return():P.return(u.value)})};
nT.prototype.set=function(V,t,x){x=x===void 0?31536E3:x;var u=this,Z,P,K;return g.Q(function(R){if(R.J==1)return Z=(0,g.Tu)(),P={key:V,value:t,expirationTimestampMs:Z+x*1E3},g.m(R,K97(u.token),2);K=R.S;return g.m(R,g.jp(K,"prefs",P),0)})};
nT.prototype.remove=function(V){var t=this,x;return g.Q(function(u){if(u.J==1)return g.m(u,K97(t.token),2);x=u.S;return g.m(u,x.delete("prefs",V),0)})};
g.A(c9,g.xe);g.A(yQ,bk_);yQ.prototype.N=function(V,t){t=kIr(t);V=(new TextEncoder).encode(JSON.stringify(V));return this.J.encrypt(V,t)};
yQ.prototype.S=function(V,t){if(!(V instanceof Uint8Array))throw qI$(1);var x=new TextDecoder;t=kIr(t);V=this.J.decrypt(V,t);return JSON.parse(x.decode(V))};
var ikU={accountLinkStatusEntity:QNc,booleanEntity:L0_,buttonEntity:dAF,captionTrack:Ywt,channelHandle:I7j,commerceAcquisitionClientPayloadEntity:JO$,commerceCartListEntity:hi7,contextNoteFeedEntityPayload:vSr,continuationTokenEntity:d5$,downloadQualityPickerEntity:W0E,downloadsPageRefreshTokenEntity:nS7,downloadsPageViewConfigurationEntity:Z_c,downloadStatusEntity:oSF,sfvAudioItemCurrentlyPlayingEntity:cO$,emojiFountainDataEntity:DAE,emojiCustomizationSetEntity:UAF,fakeChannel:MNt,fakePlaylist:gS$,
fakePlaylistEntryCollection:zUF,fakeVideo:Bz_,fakeVideoDescription:m5n,featuredProductsEntity:b_c,flowStateEntity:YBt,iconBadgeEntity:wYU,interstitialInteractionStateEntity:rn$,liveChatPollStateEntity:Tz7,liveReactionsDataEntity:eir,logoEntity:a7r,macroMarkerEntity:PWE,mainDownloadsLibraryEntity:cnj,mainDownloadsListEntity:jNn,mainPlaylistDownloadStateEntity:l77,mainPlaylistEntity:CqF,mainPlaylistVideoEntity:JnE,mainVideoDownloadStateEntity:H27,mainVideoEntity:t9F,markersEngagementPanelSyncEntity:KWi,
markersVisibilityOverrideEntity:qwr,musicAlbumReleaseDetail:AOs,musicAlbumReleaseDownloadMetadataEntity:i_Y,musicAlbumRelease:pYU,musicAlbumReleaseUserDetail:SwF,musicArtistDetail:Idj,musicArtist:GCj,musicArtistUserDetail:vws,musicDownloadsLibraryEntity:O_7,musicLibraryEdit:LWj,musicLibraryStatusEntity:FWU,musicPlaylist:gwi,musicPlaylistDownloadMetadataEntity:sx7,musicShare:XYF,musicTrackDetail:BKc,musicTrackDownloadMetadataEntity:NKz,musicTrack:zic,musicTrackUserDetail:mAE,offlineOrchestrationActionWrapperEntity:Qxs,
offlineVideoPolicy:adE,offlineVideoStreams:rOF,offlineabilityEntity:U5U,orchestrationWebSamplingEntity:D5i,pageHeaderEntity:ldY,pdpStateEntity:Vhi,pinnedProductEntity:EwY,playbackData:TK$,playerStateEntity:Rii,quantityIncrementerEntity:ths,refresh:WW7,saveToPlaylistListEntity:yOU,settingEntity:jxE,stringEntity:F0s,suggestedFeedbackChipStateEntity:fdY,transfer:own,trendingOfferEntity:kCz,videoDownloadContextEntity:nw7,videoOverviewAsyncDataEntity:xq_,videoPlaybackPositionEntity:CW_,votingEntity:H_i,
ytMainChannelEntity:xA_,youchatPendingResponseEntity:$Ar,ytMainDownloadedVideoEntity:eUi,ytMainVideoEntity:utj};g.A(ed,bk_);ed.prototype.N=function(V){return V};
ed.prototype.S=function(V){if(V instanceof Uint8Array)throw qI$(0);return V};
g.A(d6,g.c);d6.prototype.observe=function(V){var t=this;this.observers.push(V);return function(){var x=t.observers.indexOf(V);x>=0&&t.observers.splice(x,1)}};
d6.prototype.S=function(V){XRE(this,V.data)};
d6.prototype.NP=function(){this.channel.close()};
var QQ_,zws=new g.rI("elementsCommand");var Lc=new g.rI("entityBatchUpdate");var NJ_=new g.rI("downloadStatusEntity");var Qyi=new g.rI("mainPlaylistEntityActionMetadata");var Cc=new g.rI("mainVideoEntityActionMetadata");var jo_=new g.rI("musicPlaylistEntityActionMetadata");var ibi=new g.rI("musicTrackEntityActionMetadata");var dar=new g.rI("localImageEntityActionMetadata");var rc=new g.rI("playbackDataActionMetadata");var Bmn=new g.rI("transferEntityActionMetadata");var O3s=new g.rI("videoPlaybackPositionEntityActionMetadata");var dqr;new g.v$;new g.v$;V3n.prototype.request=function(V,t,x){t=t===void 0?{}:t;return this.locks.request(V,t,function(u){return x(u)})};var ul=g.Ww.caches,x3,Pbi;tG.prototype.open=function(V){return ul.open(udU(V))};
tG.prototype.has=function(V){return ul.has(udU(V))};
tG.prototype.delete=function(V){return ul.delete(udU(V))};
tG.prototype.match=function(V,t){var x=this,u,Z,P,K,R,f;return g.Q(function(b){switch(b.J){case 1:return g.m(b,x.keys(),2);case 2:u=b.S,Z=g.G(u),P=Z.next();case 3:if(P.done){b.FX(5);break}K=P.value;return g.m(b,x.open(K),6);case 6:return R=b.S,g.m(b,R.match(V,t),7);case 7:if(f=b.S)return b.return(f);P=Z.next();b.FX(3);break;case 5:return b.return()}})};
g.A(xsF,tG);xsF.prototype.keys=function(){var V,t,x,u,Z,P,K,R,f;return g.Q(function(b){if(b.J==1)return V=[],t=g.uU("CacheStorage keys"),g.m(b,ul.keys(),2);x=b.S;u=g.G(x);for(Z=u.next();!Z.done;Z=u.next()){P=Z.value;var E=P.indexOf(":");K=E===-1?{pS:P}:{pS:P.substring(0,E),datasyncId:P.substring(E+1)};R=K.pS;f=K.datasyncId;f===t&&V.push(R)}return b.return(V)})};g.A(PC,g.c);PC.prototype.N=function(V){this.api.Os("onOfflineOperationFailure",V.data)};
PC.prototype.W=function(V){this.api.publish("offlinetransferpause",V.data)};
PC.prototype.NP=function(){var V;(V=this.J)==null||V.close();var t;(t=this.S)==null||t.close()};Rwt.prototype.e3=function(){this.J&&qG(this)};
Rwt.prototype.u7=function(){this.S&&this.S.resolve();this.N=this.J=!1;this.X()};var DrU=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var M3z="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Wgj="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.A(KVn,Y3);KVn.prototype.S=function(V){return bl(V)?fLs(this,V):EK(V)?EsU(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};g.A(kXU,Y3);kXU.prototype.S=function(V){return EK(V)?i3U(this,V):soY(V)?s17(this,V):k3(V)?Nmr(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};g.q=pas.prototype;g.q.SZs=function(V){var t=this,x,u,Z,P;return g.Q(function(K){if(!g.J(V.state,128))return K.FX(0);x=V.state.Mv;var R=(u=x)==null?void 0:u.errorCode,f=(Z=x)==null?void 0:Z.sb;P=R==="net.connect"&&f===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(R==null?0:R.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.m(K,t.ys(t.player.getVideoData().videoId,P),0)})};
g.q.ys=function(V,t){var x=this;return g.Q(function(u){if(u.J==1){if(x.S)return u.return();x.S=!0;return t==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(oU(x,V,!1,!0),u.FX(0)):g.m(u,WC(x,V),3)}g.mr(V,4);return g.m(u,x.J.ys(t),0)})};
g.q.VJ=function(V){V.status===2?(V.status!==this.N&&(iKi(this.J),g.mr(V.videoId,2)),V.lE&&AJ_(this.J,V.videoId,V.lE)):V.status===4?(WC(this,V.videoId),this.ys(V.videoId,V.NS?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):V.status===1&&p2n(this.J);this.N=V.status;this.api.Os("localmediachange",{videoId:V.videoId,status:V.status})};
g.q.v8=function(){var V=this,t;return g.Q(function(x){if(x.J==1){if(V.S)return x.return();V.S=!0;t=V.player.getVideoData().videoId;return g.m(x,WC(V,t),2)}return g.m(x,V.J.v8(),0)})};
g.q.VZ=function(V){switch(V){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.q.T=function(V){return this.api.K().T(V)};g.A(FVi,Y3);FVi.prototype.S=function(V){return bl(V)?gsE(this,V):EK(V)?XaE(this,V):soY(V)?z9F(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};rR_.prototype.J=function(V,t){var x=V.action.actionMetadata.priority-t.action.actionMetadata.priority;x===0&&(V.J<t.J?x=-1:V.J>t.J&&(x=1));return x};g.A(nc,g.c);nc.prototype.NP=function(){this.X&&this.X();g.c.prototype.NP.call(this)};
nc.prototype.createAction=function(V,t){var x=g.Oi(V.entityKey).entityType,u=g.m3(16);return new pc(x,u,V,t.actionId,t.rootActionId)};
nc.prototype.wk=function(V){var t=this,x,u,Z,P,K,R,f,b,E;return g.Q(function(k){if(k.J==1){if(t.uD())return k.return();u=(x=V.offlineOrchestrationActionWrapperEntity)!=null?x:new Set;Z=[];P=g.G(u);for(K=P.next();!K.done;K=P.next())R=K.value,f=g.Oi(R),b=f.entityId,os_(t.J,b)||Z.push(R);return g.m(k,CZF(t,Z),2)}E=k.S;return g.m(k,drs(t,E),0)})};
nc.prototype.retry=function(){var V=this;return g.Q(function(t){return g.m(t,JRE(V),0)})};waE.prototype.Ge=function(V,t){t=t===void 0?!0:t;var x=this,u,Z,P,K,R,f,b,E;return g.Q(function(k){switch(k.J){case 1:if(!x.J)return k.return();u=[];Z=g.AS(x.J.S,t);P=[];for(K={c6:0};K.c6<Z.length;K={c6:K.c6},K.c6++)R=Z[K.c6],f=x.J.oR(R,"json3"),b=g.nJ(f,{withCredentials:!0,format:"RAW"},3,500).then(function(O){return function(N){N={metadata:g.Os(Z[O.c6]),trackData:N.xhr.responseText};P.push(N)}}(K)).q9(function(O){Zm("Caption fetch error",O)}),u.push(b);
return g.m(k,Glr(u),2);case 2:return g.AT(k,3),g.m(k,yXs(V,P),5);case 5:g.GK(k,0);break;case 3:E=g.I9(k),Zm("Caption DB transaction error",E),g.pl(k)}})};g.A(cC,g.c);cC.prototype.NP=function(){this.S&&this.S();g.c.prototype.NP.call(this)};
cC.prototype.N=function(V){var t=this,x,u,Z,P,K,R,f,b;return g.Q(function(E){u=(x=V.transfer)!=null?x:new Set;Z=[];P=g.G(u);for(K=P.next();!K.done;K=P.next())R=K.value,f=g.Oi(R),b=f.entityId,Z.push(b);return Z.length===0?E.return():g.m(E,xa_(t,Z),0)})};g.A(qqU,g.c);g.q=qqU.prototype;g.q.NP=function(){this.zU&&this.zU();this.cX.dispose();this.W.dispose();this.Es&&g.dR(this.B.YV,this.Es);this.BX&&g.dR(this.B.YV,this.BX);g.c.prototype.NP.call(this)};
g.q.UeC=function(V){var t=this,x,u,Z;return g.Q(function(P){switch(P.J){case 1:x=g.si(V,"transfer");if(t.J&&x===t.J.key){oU(t.L,t.G,!0);t.W.stop();P.FX(0);break}return g.m(P,CT(t.S,{mode:"readwrite",LI:!0},function(K){return jd(K,x,"transfer").then(function(R){if(R&&R.transferState!=="TRANSFER_STATE_COMPLETE"&&R.transferState!=="TRANSFER_STATE_FAILED")return R.transferState="TRANSFER_STATE_PAUSED_BY_USER",U_(K,R,"transfer").then(function(){return R})})}),3);
case 3:u=P.S;if(!u){P.FX(0);break}if(!V||!t.N){P.FX(5);break}return g.m(P,il(V,t.N,t.S,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.m(P,ll(t,V),7);case 7:Z=P.S,iIr({videoId:V,l9:u,offlineModeType:Z}),g.pl(P)}})};
g.q.FsX=function(){var V=this;if(this.J&&this.G){oU(this.L,this.G,!1);var t=this.J,x=(t==null?0:t.key)?g.Oi(t.key).entityId:"";x&&this.N&&(new Promise(function(u,Z){il(x,V.N,V.S,"DOWNLOAD_STATE_PAUSED").catch(function(P){Z(P)})})).catch(function(u){Zm("Download state setting error",u)})}this.W.stop()};
g.q.Ff=function(){this.J?$a7(this,this.J):j4(this)};
g.q.MQ=function(V){var t=this;return g.Q(function(x){switch(x.J){case 1:if(!t.J){x.FX(2);break}if(t.J.transferState==="TRANSFER_STATE_COMPLETE"||t.J.transferState==="TRANSFER_STATE_FAILED"||!V.transfer||!V.transfer.has(t.J.key)){x.FX(3);break}return g.m(x,hg(t.S,t.J.key,"transfer"),4);case 4:t.J=x.S;if(t.J){x.FX(3);break}return g.m(x,bKU(t),3);case 3:if(t.J)return x.return();case 2:return g.m(x,j4(t),0)}})};
g.q.ys=function(V,t){var x=this,u,Z,P,K,R;return g.Q(function(f){switch(f.J){case 1:if(!x.J){HC(x,"onTransferFailure: "+V);f.FX(2);break}u=x.J;P=((Z=u)==null?0:Z.key)?g.Oi(u.key).entityId:"";a:switch(V){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var b=!1;break a;default:b=!0}return b&&Sqs(x)?g.m(f,UK(x,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.m(f,
GpY(x,V),5);case 5:if(!P||!x.N){f.FX(2);break}return g.m(f,il(P,x.N,x.S,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.m(f,ll(x,P),9);case 9:K=f.S;fc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:P,l9:u,offlineModeType:K});if(!P||!x.N){f.FX(2);break}return g.m(f,il(P,x.N,x.S,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:yH(x),R=j4(x,!0),t&&t(R),g.pl(f)}})};
g.q.v8=function(V){var t=this,x,u,Z,P,K,R,f,b,E,k,O,N;return g.Q(function(p){switch(p.J){case 1:if(!t.J){HC(t,"onMaybeTransferStreamsExpired");p.FX(2);break}return Sqs(t)?g.m(p,UK(t,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.m(p,GpY(t,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!t.N){p.FX(2);break}x=t.J;Z=((u=x)==null?0:u.key)?g.Oi(x.key).entityId:"";if(!Z){p.FX(2);break}return g.m(p,il(Z,t.N,t.S,"DOWNLOAD_STATE_FAILED"),2);case 9:return t.J||HC(t,"onMaybeTransferStreamsExpiredRetryAttempting"),
P=t.J,R=((K=P)==null?0:K.key)?g.Oi(P.key).entityId:"",g.m(p,ll(t,R),10);case 10:return f=p.S,fc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:R,l9:P,offlineModeType:f}),b=ST7(),g.dx(b,rc,{isEnqueuedForExpiredStreamUrlRefetch:!0}),E=g.si(R,"playbackData"),k={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:E,actionMetadata:b},O=S4(new pc("playbackData",R,k)),g.m(p,Jg(t.S,O,"offlineOrchestrationActionWrapperEntity"),2);case 2:yH(t),N=j4(t,!0),
V&&V(N),g.pl(p)}})};
var FmE={},INE=(FmE.TRANSFER_STATE_TRANSFERRING=1,FmE.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,FmE);g.q=Dm.prototype;g.q.g4=function(){return this.G.promise};
g.q.aE=function(){if(this.S&&this.L)return this.G.promise;FKc(this).then(this.G.resolve).catch(this.G.reject);return this.G.promise};
g.q.Rh=function(V){var t={};return t.playbackData=new KVn(V,this.Rj,this.J),t.transfer=new FVi(V,this.Rj),t.videoPlaybackPositionEntity=new kXU(V,this.Rj),t};
g.q.oP=function(){var V=this;return g.Q(function(t){return V.S?g.m(t,Rz$(V.S),0):t.FX(0)})};
g.q.j2=function(){var V=this,t,x;return g.Q(function(u){if(u.J==1)return V.S||V.L?g.m(u,V.g4(),2):u.return();V.C!==void 0&&(g.XV(V.C),V.C=void 0);V.W!==void 0&&(g.XV(V.W),V.W=void 0);(t=V.S)==null||t.dispose();V.S=void 0;(x=V.L)==null||x.dispose();V.L=void 0;V.api.Os("onOrchestrationLostLeader");V.G=new g.v$;g.pl(u)})};
g.q.isOrchestrationLeader=function(){return this.N.J};
g.q.Df=function(){return g.Q(function(V){return V.return(!1)})};
g.q.eT=function(V){var t=this.J;t.api.publish("offlinetransferpause",V);var x;(x=t.S)==null||x.postMessage(V)};
g.q.Ff=function(V){var t,x;return g.Q(function(u){if(u.J==1)return g.m(u,VH(),2);t=u.S;if(!t)return u.return();x=g.si(V,"transfer");return g.m(u,CT(t,{mode:"readwrite",LI:!0},function(Z){var P=jd(Z,x,"transfer"),K=jd(Z,g.si(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Ye.all([P,K]).then(function(R){R=g.G(R);var f=R.next().value;var b=R.next().value;return f&&f.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(f.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",U_(Z,f,"transfer").then(function(){fc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:V,l9:f,offlineModeType:b==null?void 0:b.offlineModeType});return g.Ye.resolve(null)})):g.Ye.resolve(null)})}),0)})};
g.q.B4=function(V){V=V===void 0?43200:V;var t=this,x,u,Z,P,K,R,f,b;return g.Q(function(E){if(E.J==1)return t.B.U8()?g.m(E,VH(),2):E.return(Mgs());if(E.J!=3){x=E.S;if(!x)return E.return([]);u=Date.now()/1E3;return g.m(E,w6(x,"offlineVideoPolicy"),3)}Z=E.S;P=[];K=g.G(Z);for(R=K.next();!R.done;R=K.next())f=R.value,Number(f.lastUpdatedTimestampSeconds)+V<=u&&(b=g.Oi(f.key).entityId,P.push(b));return P.length?E.return(e4(t,P,t.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):E.return([])})};
g.q.deleteAll=function(){return e4(this,["!*$_ALL_ENTITIES_!*$"],this.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.q.refreshAllStaleEntities=function(V){var t=this;return g.Q(function(x){return x.J==1?g.m(x,t.B4(V),2):x.return(x.S)})};
g.q.setUpPositionSyncInterval=function(V){var t=this;this.W!==void 0&&(g.XV(this.W),this.W=void 0);var x=V!=null?V:864E5;this.W=g.Mc(function(){t.nB(x)},x)};
g.q.nB=function(V){var t=this,x,u,Z,P,K,R;return g.Q(function(f){switch(f.J){case 1:return g.AT(f,2),g.m(f,nT.getInstance(),4);case 4:x=f.S;if(!x)throw Error("prefStorage is undefined");return g.m(f,x.get("psi"),5);case 5:u=f.S;P=((Z=u)==null?0:Z.uQ)?Number(u.uQ)/1E3:0;K=Date.now();if(!(P+V<=K)){f.FX(6);break}return g.m(f,e4(t,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.GK(f,0);break;case 2:R=g.I9(f),Zm("Offline manager error",R),
g.pl(f)}})};
g.q.D5=function(){var V=this,t,x,u,Z,P,K,R;return g.Q(function(f){if(f.J==1)return g.m(f,VH(),2);if(f.J!=3)return(t=f.S)?g.m(f,w6(t,"transfer"),3):f.return([]);x=f.S;u=[];Z=g.G(x);for(P=Z.next();!P.done;P=Z.next())K=P.value,K.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&K.key&&(R=g.Oi(K.key).entityId,u.push(R));return f.return(X27(V,u))})};
g.q.Uf=function(){return g.Q(function(V){return V.return([])})};
g.q.rP=function(){return g.Q(function(V){g.pl(V)})};
g.q.Ow=function(){return g.Q(function(V){g.pl(V)})};g.A(zz_,Y3);zz_.prototype.S=function(V){return bl(V)?Yqn(this,V):EK(V)?aNU(this,V):k3(V)?rJY(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};
var dc=[10];g.A(cJU,Y3);cJU.prototype.S=function(V){return bl(V)?lNz(this,V):EK(V)?HK_(this,V):k3(V)?UaF(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};
var jyY=[10];g.A(ez$,Y3);ez$.prototype.S=function(V){return EK(V)?ChE(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};g.A(JJE,Dm);g.q=JJE.prototype;g.q.Rh=function(V){var t=Dm.prototype.Rh.call(this,V);t.mainVideoEntity=new cJU(V,this.Rj,this.J);t.mainPlaylistEntity=new zz_(V,this.Rj,this.J);t.mainDownloadsListEntity=new ez$(V,this.Rj,this.J);return t};
g.q.refreshAllStaleEntities=function(V,t){var x=this,u,Z,P,K,R,f,b,E,k,O,N;return g.Q(function(p){switch(p.J){case 1:u=[];if(!x.Rj.T("web_player_offline_playlist_auto_refresh")){p.FX(2);break}return g.m(p,hzn(x,V,t),3);case 3:u=p.S;case 2:return g.m(p,nT.getInstance(),4);case 4:return Z=p.S,g.m(p,(P=Z)==null?void 0:P.get("sdois"),5);case 5:return K=p.S,g.m(p,(R=Z)==null?void 0:R.get("lmqf"),6);case 6:f=p.S;if(!K){p.FX(7);break}E=u;k=E.concat;return g.m(p,w2j(x,K,(b=f)!=null?b:"SD",V===0),8);case 8:u=
k.call(E,p.S);case 7:return O=u,N=O.concat,g.m(p,Dm.prototype.refreshAllStaleEntities.call(x,V,t),9);case 9:return u=N.call(O,p.S),p.return(u)}})};
g.q.Df=function(V){var t,x,u,Z,P,K,R,f;return g.Q(function(b){if(b.J==1)return g.m(b,VH(),2);if(b.J!=3)return(t=b.S)?g.m(b,hg(t,g.aA,"mainDownloadsListEntity"),3):b.return(!1);x=b.S;if((u=x)==null?0:(Z=u.downloads)==null?0:Z.length)for(P=g.si(V,"mainVideoEntity"),K=g.G(x.downloads),R=K.next();!R.done;R=K.next())if(f=R.value,f.videoItem===P)return b.return(!0);return b.return(!1)})};
g.q.Uf=function(){var V=this,t,x,u,Z,P,K,R,f;return g.Q(function(b){if(b.J==1)return g.m(b,VH(),2);if(b.J!=3)return(t=b.S)?g.m(b,w6(t,"downloadStatusEntity"),3):b.return([]);x=b.S;u=[];Z=g.G(x);for(P=Z.next();!P.done;P=Z.next())K=P.value,K.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&K.key&&(R=g.Oi(K.key).entityId,u.push(R));return u.length?(f={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},b.return(e4(V,u,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
f))):b.return([])})};
g.q.Ow=function(){var V;return g.Q(function(t){return t.J==1?g.m(t,VH(),2):(V=t.S)?g.m(t,CT(V,{mode:"readwrite",LI:!0},function(x){return lO(x,"mainVideoEntity").then(function(u){var Z=[];u=g.G(u);for(var P=u.next();!P.done;P=u.next()){P=P.value;var K=void 0;(K=P.userState)!=null&&K.playbackPosition||(K=g.Oi(P.key).entityId,K={key:g.si(K,"videoPlaybackPositionEntity"),videoId:K,lastPlaybackPositionSeconds:"0"},Z.push(U_(x,K,"videoPlaybackPositionEntity")),P.userState={playbackPosition:K.key},Z.push(U_(x,
P,"mainVideoEntity")))}return g.Ye.all(Z)})}),0):t.return()})};
g.q.rP=function(){var V,t,x,u,Z,P,K,R,f,b,E,k,O,N,p,I,L,M,z,Y,r,n,U,d,uL,q1,w,H,C,S,D,ws,Ic,t_,gs,Cl,uz,Nt;return g.Q(function(F){if(F.J==1)return g.m(F,VH(),2);if(F.J!=3){V=F.S;if(!V)return F.return();t=g.si("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.m(F,CT(V,{mode:"readonly",LI:!0},function(X){return g.Ye.all([jd(X,t,"mainDownloadsListEntity"),jd(X,g.aA,"mainDownloadsListEntity"),lO(X,"mainVideoEntity"),lO(X,"mainPlaylistEntity")])}),3)}x=F.S;
u=g.G(x);Z=u.next().value;P=u.next().value;K=u.next().value;R=u.next().value;f=Z;b=P;E=K;k=R;O=new Set;if((N=f)==null?0:(p=N.downloads)==null?0:p.length)for(I=g.G(f.downloads),L=I.next();!L.done;L=I.next())M=L.value,z=void 0,(Y=(z=M.videoItem)!=null?z:M.playlistItem)&&O.add(Y);if((r=b)==null?0:(n=r.downloads)==null?0:n.length)for(U=g.G(b.downloads),d=U.next();!d.done;d=U.next())uL=d.value,uL.videoItem&&O.add(uL.videoItem);q1=new Set;w=[];H=g.G(k);for(C=H.next();!C.done;C=H.next()){S=C.value;if(S.videos)for(D=
g.G(S.videos),ws=D.next();!ws.done;ws=D.next())Ic=ws.value,(t_=JSON.parse(g.Oi(Ic).entityId).videoId)&&q1.add(t_);S.key&&!O.has(S.key)&&w.push(S.key)}gs=g.G(E);for(Cl=gs.next();!Cl.done;Cl=gs.next())uz=Cl.value,uz.key&&!O.has(uz.key)&&(Nt=g.Oi(uz.key).entityId,q1.has(Nt)||w.push(uz.key));return w.length?g.m(F,Qos(V,w),0):F.FX(0)})};g.A(V0i,Y3);V0i.prototype.S=function(V){return bl(V)?xKE(this,V):EK(V)?uai(this,V):k3(V)?ZbF(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};
var JG=[10];g.A(KmE,Y3);KmE.prototype.S=function(V){return bl(V)?RJc(this,V):EK(V)?frc(this,V):k3(V)?$Kj(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};
var hG=[10];g.A(k6$,Y3);k6$.prototype.S=function(V){return bl(V)?NyE(this,V):EK(V)?pkF(this,V):k3(V)?Amr(this,V):Promise.reject(Error("Unsupported action type: "+V.actionType))};
var sOs=[10];g.A(wc,Dm);wc.prototype.Rh=function(V){var t=Dm.prototype.Rh.call(this,V);t.musicTrack=new k6$(V,this.J);t.musicPlaylist=new KmE(V,this.J);t.musicAlbumRelease=new V0i(V,this.J);return t};
wc.prototype.refreshAllStaleEntities=function(V,t){var x=this,u,Z,P;return g.Q(function(K){if(K.J==1)return g.m(K,G6j(x,V,t),2);if(K.J!=3)return Z=u=K.S,P=Z.concat,g.m(K,Dm.prototype.refreshAllStaleEntities.call(x,V,t),3);u=P.call(Z,K.S);return K.return(u)})};g.A(IrY,g.m5);g.q=IrY.prototype;g.q.create=function(){var V=this;g.y(this,this.events);g.J2(this.Rj)?this.J=new JJE(this.Rj,this.player):g.Dp(this.Rj)&&(this.J=new wc(this.Rj,this.player));this.events.Z(this.player,"onPlaybackStartExternal",function(){V.er()});
this.events.Z(this.player,"videodatachange",function(){V.er()});
this.Rj.T("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.GP)};
g.q.lL=function(){return!1};
g.q.mE=function(V,t,x,u){var Z=this;return g.Q(function(P){return Z.J?P.return(e4(Z.J,V,t,x,u)):P.return(Promise.reject())})};
g.q.deleteAll=function(){return this.J.deleteAll()};
g.q.B4=function(V){return this.J.B4(V)};
g.q.refreshAllStaleEntities=function(V){return this.J.refreshAllStaleEntities(V)};
g.q.setUpPositionSyncInterval=function(V){this.J.setUpPositionSyncInterval(V)};
g.q.eT=function(V){this.J.eT(V)};
g.q.Ff=function(V){return this.J.Ff(V)};
g.q.er=function(){var V=this,t;return g.Q(function(x){t=V.player.getVideoData();return g.hM(t)?vys(t)&&V.S!==t.clientPlaybackNonce?g.m(x,Lms(V,t),0):x.FX(0):x.return()})};
g.q.GP=function(V){var t=this,x,u,Z,P,K,R,f;return g.Q(function(b){if(b.J==1)return x=t.player.getVideoData(),u=x.Cv,g.LC(V,2)||g.LC(V,512)?g.m(b,VH(),2):b.return();if(b.J!=3){Z=b.S;if(!Z)return Zm("PES is undefined"),b.return();P=x.videoId;return g.m(b,hg(Z,g.si(P,"mainVideoEntity"),"mainVideoEntity"),3)}K=b.S;if(!K)return b.return();R=Math.floor(u).toString();f={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:R}};return g.m(b,t.mE([P],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
f),0)})};
g.q.isOrchestrationLeader=function(){return this.J.isOrchestrationLeader()};
g.q.updateDownloadState=function(V,t){var x,u,Z,P;return g.Q(function(K){if(K.J==1)return g.m(K,VH(),2);x=K.S;if(!x)return Zm("PES is undefined"),K.return();u=g.Oi(V);Z=u.entityType;P=u.entityId;return g.m(K,il(P,Z,x,t,!0),0)})};g.BW("offline",IrY);})(_yt_player);
